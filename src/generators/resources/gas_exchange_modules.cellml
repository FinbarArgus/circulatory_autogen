<?xml version='1.0' encoding='UTF-8'?>
<model name="modules" xmlns="http://www.cellml.org/cellml/1.1#" xmlns:cellml="http://www.cellml.org/cellml/1.1#">
    <!--//////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////module for simple O2 and CO2 calculation in a terminal ///
//////////////////////////////////////////////////////////////////////////////////////////////////////-->
    <component name="tissue_GE_simple_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="q_0" public_interface="in" units="m3"/>
        <variable name="v" public_interface="in" units="m3_per_s"/>
        <variable name="M_O2" public_interface="in" units="m3_per_s"/>
        <variable name="M_CO2" public_interface="in" units="m3_per_s"/>
        <variable name="C_O2_a" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_a" public_interface="in" units="dimensionless"/>
        <variable name="C_O2_p_init" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_p_init" public_interface="in" units="dimensionless"/>
        <variable initial_value="C_O2_p_init" name="C_O2_p" public_interface="out" units="dimensionless"/>
        <variable initial_value="C_CO2_p_init" name="C_CO2_p" public_interface="out" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_O2_p</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v</ci>
                            <apply>
                                <minus/>
                                <ci>C_O2_a</ci>
                                <ci>C_O2_p</ci>
                            </apply>
                        </apply>
                        <ci>M_O2</ci>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_CO2_p</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v</ci>
                            <apply>
                                <minus/>
                                <ci>C_CO2_a</ci>
                                <ci>C_CO2_p</ci>
                            </apply>
                        </apply>
                        <ci>M_CO2</ci>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
        </math>
    </component>
    <!--//////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////module for O2 and CO2 calculation in a pulmonary system///
//////////////////////////////////////////////////////////////////////////////////////////////////////-->
    <component name="pulmonary_GE_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="q_0" public_interface="in" units="m3"/>
        <variable name="v" public_interface="in" units="m3_per_s"/>
        <variable name="M_O2" public_interface="out" units="m3_per_s"/>
        <variable name="M_CO2" public_interface="out" units="m3_per_s"/>
        <variable name="C_O2_v" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_v" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_p_init" public_interface="in" units="dimensionless"/>
        <variable name="C_O2_p_init" public_interface="in" units="dimensionless"/>
        <variable initial_value="C_O2_p_init" name="C_O2_p" public_interface="out" units="dimensionless"/>
        <variable name="d_C_O2_p_dt" public_interface="out" units="Hz"/>
        <variable initial_value="C_CO2_p_init" name="C_CO2_p" public_interface="out" units="dimensionless"/>
        <!-- New params-->
        <variable name="k_O2" public_interface="in" units="m6_per_Js"/>
        <variable name="k_CO2" public_interface="in" units="m6_per_Js"/>
        <variable name="P_O2_A" public_interface="in" units="J_per_m3"/>
        <variable name="P_CO2_A" public_interface="in" units="J_per_m3"/>
        <variable name="shunt_fraction" public_interface="in" units="dimensionless"/>
        <!--New vars-->
        <variable name="P_O2_p" public_interface="out" units="J_per_m3"/>
        <variable name="P_CO2_p" public_interface="out" units="J_per_m3"/>
        <variable name="C_O2_a" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_a" public_interface="out" units="dimensionless"/>
        <variable name="v_p" public_interface="out" units="m3_per_s"/>
        <variable name="v_sh" public_interface="out" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>M_O2</ci>
                <apply>
                    <times/>
                    <ci>k_O2</ci>
                    <apply>
                        <minus/>
                        <ci>P_O2_A</ci>
                        <ci>P_O2_p</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>M_CO2</ci>
                <apply>
                    <times/>
                    <ci>k_CO2</ci>
                    <apply>
                        <minus/>
                        <ci>P_CO2_A</ci>
                        <ci>P_CO2_p</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_O2_p</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v_p</ci>
                            <apply>
                                <minus/>
                                <ci>C_O2_v</ci>
                                <ci>C_O2_p</ci>
                            </apply>
                        </apply>
                        <ci>M_O2</ci>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_C_O2_p_dt</ci>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v_p</ci>
                            <apply>
                                <minus/>
                                <ci>C_CO2_v</ci>
                                <ci>C_CO2_p</ci>
                            </apply>
                        </apply>
                        <ci>M_CO2</ci>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_CO2_p</ci>
                </apply>
                <ci>d_C_O2_p_dt</ci>
            </apply>
            <!-- from inverted dissociation-->
            <apply>
                <eq/>
                <ci>P_O2_p</ci>
                <apply>
                    <plus/>
                    <ci>r_1</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1</ci>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>overcap_solubility</ci>
                        <ci>C_O2_p_extra_ub</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_p</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>d_2</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>P_O2_p</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <ci>beta_2</ci>
                            <ci>P_O2_p</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- flows from shunt todo model this??-->
            <apply>
                <eq/>
                <ci>v_p</ci>
                <apply>
                    <times/>
                    <ci>v</ci>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <ci>shunt_fraction</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>v_sh</ci>
                <apply>
                    <times/>
                    <ci>v</ci>
                    <ci>shunt_fraction</ci>
                </apply>
            </apply>
            <!-- calculate arterial gas concentration due to pulmonary shunt-->
            <!-- the 0 should be dimensionless (m3_per_s -> dim)-->
            <apply>
                <eq/>
                <ci>C_O2_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <divide/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <ci>v_p</ci>
                                <ci>C_O2_p</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>v_sh</ci>
                                <ci>C_O2_v</ci>
                            </apply>
                        </apply>
                        <ci>v</ci>
                    </apply>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <divide/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <ci>v_p</ci>
                                <ci>C_CO2_p</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>v_sh</ci>
                                <ci>C_CO2_v</ci>
                            </apply>
                        </apply>
                        <ci>v</ci>
                    </apply>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
        </math>
        <!--____________ inverted dissociation curve below here___________-->
        <variable name="k_1" public_interface="in" units="J_per_m3"/>
        <variable name="k_2" public_interface="in" units="J_per_m3"/>
        <variable name="h_1" public_interface="in" units="dimensionless"/>
        <variable name="h_2" public_interface="in" units="dimensionless"/>
        <variable name="d_1" public_interface="out" units="J_per_m3"/>
        <variable name="d_2" public_interface="out" units="J_per_m3"/>
        <variable name="r_1" public_interface="out" units="J_per_m3"/>
        <variable name="r_2" public_interface="out" units="J_per_m3"/>
        <variable name="s_1" public_interface="out" units="J2_per_m6"/>
        <variable name="s_2" public_interface="out" units="J2_per_m6"/>
        <variable name="alpha_1" public_interface="in" units="m3_per_J"/>
        <variable name="alpha_2" public_interface="in" units="m3_per_J"/>
        <variable name="beta_1" public_interface="in" units="m3_per_J"/>
        <variable name="beta_2" public_interface="in" units="m3_per_J"/>
        <variable name="C_O2_sat" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_sat" public_interface="in" units="dimensionless"/>
        <!-- including the below to avoid divide by zero problems. This probably isn't needed.-->
        <variable name="C_O2_p_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_p_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_O2_p_extra_ub" public_interface="out" units="dimensionless"/>
        <variable name="overcap_solubility" public_interface="in" units="J_per_m3"/>
        <variable name="saturation_cap" public_interface="in" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_p_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_O2_p</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_p_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_CO2_p</ci>
                </apply>
            </apply>
            <!-- This is the amount that is extra in the plasma due to capping the amount that can be saturated.-->
            <apply>
                <eq/>
                <ci>C_O2_p_extra_ub</ci>
                <apply>
                    <max/>
                    <apply>
                        <minus/>
                        <ci>C_O2_p</ci>
                        <apply>
                            <times/>
                            <ci>C_O2_sat</ci>
                            <ci>saturation_cap</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_1</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_p_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_p_capped</ci>
                                </apply>
                            </apply>
                            <ci>h_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_p_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_p_capped</ci>
                                </apply>
                            </apply>
                            <ci>h_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="pulmonary_GE_5_lobe_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="q_0" public_interface="in" units="m3"/>
        <variable name="v_1" public_interface="in" units="m3_per_s"/>
        <variable name="v_2" public_interface="in" units="m3_per_s"/>
        <variable name="v_3" public_interface="in" units="m3_per_s"/>
        <variable name="v_4" public_interface="in" units="m3_per_s"/>
        <variable name="v_5" public_interface="in" units="m3_per_s"/>
        <variable name="v" public_interface="out" units="m3_per_s"/>
        <variable name="M_O2" public_interface="out" units="m3_per_s"/>
        <variable name="M_CO2" public_interface="out" units="m3_per_s"/>
        <variable name="C_O2_v" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_v" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_p_init" public_interface="in" units="dimensionless"/>
        <variable name="C_O2_p_init" public_interface="in" units="dimensionless"/>
        <variable initial_value="C_O2_p_init" name="C_O2_p" public_interface="out" units="dimensionless"/>
        <variable initial_value="C_CO2_p_init" name="C_CO2_p" public_interface="out" units="dimensionless"/>
        <!-- New params-->
        <variable name="k_O2" public_interface="in" units="m6_per_Js"/>
        <variable name="k_CO2" public_interface="in" units="m6_per_Js"/>
        <variable name="P_O2_A" public_interface="in" units="J_per_m3"/>
        <variable name="P_CO2_A" public_interface="in" units="J_per_m3"/>
        <variable name="shunt_fraction" public_interface="in" units="dimensionless"/>
        <!--New vars-->
        <variable name="P_O2_p" public_interface="out" units="J_per_m3"/>
        <variable name="P_CO2_p" public_interface="out" units="J_per_m3"/>
        <variable name="C_O2_a" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_a" public_interface="out" units="dimensionless"/>
        <variable name="v_p" public_interface="out" units="m3_per_s"/>
        <variable name="v_sh" public_interface="out" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>M_O2</ci>
                <apply>
                    <times/>
                    <ci>k_O2</ci>
                    <apply>
                        <minus/>
                        <ci>P_O2_A</ci>
                        <ci>P_O2_p</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>M_CO2</ci>
                <apply>
                    <times/>
                    <ci>k_CO2</ci>
                    <apply>
                        <minus/>
                        <ci>P_CO2_A</ci>
                        <ci>P_CO2_p</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_O2_p</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v_p</ci>
                            <apply>
                                <minus/>
                                <ci>C_O2_v</ci>
                                <ci>C_O2_p</ci>
                            </apply>
                        </apply>
                        <ci>M_O2</ci>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_CO2_p</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v_p</ci>
                            <apply>
                                <minus/>
                                <ci>C_CO2_v</ci>
                                <ci>C_CO2_p</ci>
                            </apply>
                        </apply>
                        <ci>M_CO2</ci>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <!-- from inverted dissociation-->
            <apply>
                <eq/>
                <ci>P_O2_p</ci>
                <apply>
                    <plus/>
                    <ci>r_1</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_p</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>d_2</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>P_O2_p</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <ci>beta_2</ci>
                            <ci>P_O2_p</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- sum love flows for now-->
            <apply>
                <eq/>
                <ci>v</ci>
                <apply>
                    <plus/>
                    <ci>v_1</ci>
                    <ci>v_2</ci>
                    <ci>v_3</ci>
                    <ci>v_4</ci>
                    <ci>v_5</ci>
                </apply>
            </apply>
            <!-- flows from shunt todo model this??-->
            <apply>
                <eq/>
                <ci>v_p</ci>
                <apply>
                    <times/>
                    <ci>v</ci>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <ci>shunt_fraction</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>v_sh</ci>
                <apply>
                    <times/>
                    <ci>v</ci>
                    <ci>shunt_fraction</ci>
                </apply>
            </apply>
            <!-- calculate arterial gas concentration due to pulmonary shunt-->
            <apply>
                <eq/>
                <ci>C_O2_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <divide/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <ci>v_p</ci>
                                <ci>C_O2_p</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>v_sh</ci>
                                <ci>C_O2_v</ci>
                            </apply>
                        </apply>
                        <ci>v</ci>
                    </apply>
                    <cn cellml:units="m3_per_s">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <divide/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <ci>v_p</ci>
                                <ci>C_CO2_p</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>v_sh</ci>
                                <ci>C_CO2_v</ci>
                            </apply>
                        </apply>
                        <ci>v</ci>
                    </apply>
                    <cn cellml:units="m3_per_s">0</cn>
                </apply>
            </apply>
        </math>
        <!--____________ inverted dissociation curve below here___________-->
        <variable name="k_1" public_interface="in" units="J_per_m3"/>
        <variable name="k_2" public_interface="in" units="J_per_m3"/>
        <variable name="h_1" public_interface="in" units="dimensionless"/>
        <variable name="h_2" public_interface="in" units="dimensionless"/>
        <variable name="d_1" public_interface="out" units="J_per_m3"/>
        <variable name="d_2" public_interface="out" units="J_per_m3"/>
        <variable name="r_1" public_interface="out" units="J_per_m3"/>
        <variable name="r_2" public_interface="out" units="J_per_m3"/>
        <variable name="s_1" public_interface="out" units="J2_per_m6"/>
        <variable name="s_2" public_interface="out" units="J2_per_m6"/>
        <variable name="alpha_1" public_interface="in" units="m3_per_J"/>
        <variable name="alpha_2" public_interface="in" units="m3_per_J"/>
        <variable name="beta_1" public_interface="in" units="m3_per_J"/>
        <variable name="beta_2" public_interface="in" units="m3_per_J"/>
        <variable name="C_O2_sat" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_sat" public_interface="in" units="dimensionless"/>
        <!-- including the below to avoid divide by zero problems.
 TODO this is a temporary fix, we should switch to using the DASH equations-->
        <variable name="C_O2_p_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_p_capped" public_interface="out" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_p_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_O2_p</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_p_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_CO2_p</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_1</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_p_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_p_capped</ci>
                                </apply>
                            </apply>
                            <ci>h_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_p_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_p_capped</ci>
                                </apply>
                            </apply>
                            <ci>h_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="gas_transport_simple_type">
        <variable name="t" public_interface="in" units="second"/>
        <variable name="C_O2_in" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_in" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_out_init" public_interface="in" units="dimensionless"/>
        <variable name="C_O2_out_init" public_interface="in" units="dimensionless"/>
        <variable initial_value="C_O2_out_init" name="C_O2_out" public_interface="out" units="dimensionless"/>
        <variable initial_value="C_CO2_out_init" name="C_CO2_out" public_interface="out" units="dimensionless"/>
        <variable name="dot_C_CO2_out" public_interface="out" units="per_s"/>
        <variable name="q_0" public_interface="in" units="m3"/>
        <variable name="v" public_interface="in" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_O2_out</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>v</ci>
                        <apply>
                            <minus/>
                            <ci>C_O2_in</ci>
                            <ci>C_O2_out</ci>
                        </apply>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>dot_C_CO2_out</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>v</ci>
                        <apply>
                            <minus/>
                            <ci>C_CO2_in</ci>
                            <ci>C_CO2_out</ci>
                        </apply>
                    </apply>
                    <ci>q_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_CO2_out</ci>
                </apply>
                <ci>dot_C_CO2_out</ci>
            </apply>
        </math>
        <!-- from inverted dissociation-->
        <variable name="P_O2_out" public_interface="out" units="J_per_m3"/>
        <variable name="P_CO2_out" public_interface="out" units="J_per_m3"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>P_O2_out</ci>
                <apply>
                    <plus/>
                    <ci>r_1</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1</ci>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>overcap_solubility</ci>
                        <ci>C_O2_out_extra_ub</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_out</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>d_2</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>P_O2_out</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <ci>beta_2</ci>
                            <ci>P_O2_out</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
        <variable name="k_1" public_interface="in" units="J_per_m3"/>
        <variable name="k_2" public_interface="in" units="J_per_m3"/>
        <variable name="h_1" public_interface="in" units="dimensionless"/>
        <variable name="h_2" public_interface="in" units="dimensionless"/>
        <variable name="d_1" public_interface="out" units="J_per_m3"/>
        <variable name="d_2" public_interface="out" units="J_per_m3"/>
        <variable name="r_1" public_interface="out" units="J_per_m3"/>
        <variable name="r_2" public_interface="out" units="J_per_m3"/>
        <variable name="s_1" public_interface="out" units="J2_per_m6"/>
        <variable name="s_2" public_interface="out" units="J2_per_m6"/>
        <variable name="alpha_1" public_interface="in" units="m3_per_J"/>
        <variable name="alpha_2" public_interface="in" units="m3_per_J"/>
        <variable name="beta_1" public_interface="in" units="m3_per_J"/>
        <variable name="beta_2" public_interface="in" units="m3_per_J"/>
        <variable name="C_O2_sat" public_interface="in" units="dimensionless"/>
        <variable name="C_CO2_sat" public_interface="in" units="dimensionless"/>
        <!-- including the below to avoid divide by zero problems.-->
        <variable name="C_O2_out_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_out_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_O2_out_extra_ub" public_interface="out" units="dimensionless"/>
        <variable name="overcap_solubility" public_interface="in" units="J_per_m3"/>
        <variable name="saturation_cap" public_interface="in" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_out_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_O2_out</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_out_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_CO2_out</ci>
                </apply>
            </apply>
            <!-- This is the amount that is extra in the plasma due to capping the amount that can be saturated.-->
            <apply>
                <eq/>
                <ci>C_O2_out_extra_ub</ci>
                <apply>
                    <max/>
                    <apply>
                        <minus/>
                        <ci>C_O2_out</ci>
                        <apply>
                            <times/>
                            <ci>C_O2_sat</ci>
                            <ci>saturation_cap</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_1</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_out_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_out_capped</ci>
                                </apply>
                            </apply>
                            <ci>h_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_out_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_out_capped</ci>
                                </apply>
                            </apply>
                            <ci>h_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="respiratory_gas_transport_type">
        <variable name="t" public_interface="in" units="second"/>
        <!--constants-->
        <variable name="F_O2_i" public_interface="in" units="dimensionless"/>
        <variable name="F_CO2_i" public_interface="in" units="dimensionless"/>
        <variable name="P_atm" public_interface="in" units="J_per_m3"/>
        <variable name="P_ws" public_interface="in" units="J_per_m3"/>
        <variable name="F_O2_D_init" public_interface="in" units="dimensionless"/>
        <variable name="F_O2_A_init" public_interface="in" units="dimensionless"/>
        <variable name="F_CO2_D_init" public_interface="in" units="dimensionless"/>
        <variable name="F_CO2_A_init" public_interface="in" units="dimensionless"/>
        <!-- This K causes a loss in mass? fix when turning into bond-graph-->
        <variable name="K_LOSSES" public_interface="in" units="dimensionless"/>
        <!-- volume fractions-->
        <variable initial_value="F_O2_D_init" name="F_O2_D" public_interface="out" units="dimensionless"/>
        <variable initial_value="F_CO2_D_init" name="F_CO2_D" public_interface="out" units="dimensionless"/>
        <variable initial_value="F_O2_A_init" name="F_O2_A" public_interface="out" units="dimensionless"/>
        <variable initial_value="F_CO2_A_init" name="F_CO2_A" public_interface="out" units="dimensionless"/>
        <!-- partial pressures, outputs to the pulmonary gas exchange model-->
        <variable name="P_O2_A" public_interface="out" units="J_per_m3"/>
        <variable name="P_CO2_A" public_interface="out" units="J_per_m3"/>
        <!-- inputs from lung model-->
        <variable name="v_ml" public_interface="in" units="m3_per_s"/>
        <variable name="v_bA" public_interface="in" units="m3_per_s"/>
        <variable name="q_D" public_interface="in" units="m3"/>
        <variable name="q_A" public_interface="in" units="m3"/>
        <!--inputs from pulmonary gas exchange model-->
        <variable name="M_O2" public_interface="in" units="m3_per_s"/>
        <variable name="M_CO2" public_interface="in" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>F_O2_D</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <times/>
                            <apply>
                                <max/>
                                <ci>v_ml</ci>
                                <cn cellml:units="m3_per_s">0</cn>
                            </apply>
                            <apply>
                                <minus/>
                                <ci>F_O2_i</ci>
                                <ci>F_O2_D</ci>
                            </apply>
                        </apply>
                        <apply>
                            <times/>
                            <apply>
                                <max/>
                                <apply>
                                    <minus/>
                                    <ci>v_bA</ci>
                                </apply>
                                <cn cellml:units="m3_per_s">0</cn>
                            </apply>
                            <apply>
                                <minus/>
                                <ci>F_O2_D</ci>
                                <ci>F_O2_A</ci>
                            </apply>
                        </apply>
                    </apply>
                    <ci>q_D</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>F_CO2_D</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <times/>
                            <apply>
                                <max/>
                                <ci>v_ml</ci>
                                <cn cellml:units="m3_per_s">0</cn>
                            </apply>
                            <apply>
                                <minus/>
                                <ci>F_CO2_i</ci>
                                <ci>F_CO2_D</ci>
                            </apply>
                        </apply>
                        <apply>
                            <times/>
                            <apply>
                                <max/>
                                <apply>
                                    <minus/>
                                    <ci>v_bA</ci>
                                </apply>
                                <cn cellml:units="m3_per_s">0</cn>
                            </apply>
                            <apply>
                                <minus/>
                                <ci>F_CO2_D</ci>
                                <ci>F_CO2_A</ci>
                            </apply>
                        </apply>
                    </apply>
                    <ci>q_D</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>F_O2_A</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <times/>
                            <apply>
                                <max/>
                                <ci>v_bA</ci>
                                <cn cellml:units="m3_per_s">0</cn>
                            </apply>
                            <apply>
                                <minus/>
                                <ci>F_O2_D</ci>
                                <ci>F_O2_A</ci>
                            </apply>
                        </apply>
                        <apply>
                            <times/>
                            <ci>K_LOSSES</ci>
                            <ci>M_O2</ci>
                        </apply>
                    </apply>
                    <ci>q_A</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>F_CO2_A</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <times/>
                            <apply>
                                <max/>
                                <ci>v_bA</ci>
                                <cn cellml:units="m3_per_s">0</cn>
                            </apply>
                            <apply>
                                <minus/>
                                <ci>F_CO2_D</ci>
                                <ci>F_CO2_A</ci>
                            </apply>
                        </apply>
                        <apply>
                            <times/>
                            <ci>K_LOSSES</ci>
                            <ci>M_CO2</ci>
                        </apply>
                    </apply>
                    <ci>q_A</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_O2_A</ci>
                <apply>
                    <times/>
                    <ci>F_O2_A</ci>
                    <apply>
                        <minus/>
                        <ci>P_atm</ci>
                        <ci>P_ws</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_A</ci>
                <apply>
                    <times/>
                    <ci>F_CO2_A</ci>
                    <apply>
                        <minus/>
                        <ci>P_atm</ci>
                        <ci>P_ws</ci>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="temp">
        <variable name="v" public_interface="in" units="m3_per_s"/>
        <variable initial_value="0.18" name="C_O2_in" public_interface="in" units="dimensionless"/>
        <variable initial_value="0.18" name="C_O2_out" public_interface="out" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_out</ci>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>v</ci>
                            <ci>C_O2_in</ci>
                        </apply>
                        <apply>
                            <times/>
                            <ci>v</ci>
                            <ci>C_O2_out</ci>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>v</ci>
                        <ci>v</ci>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="capillary_GE">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="C_O2_c_init" name="C_O2_c" public_interface="out" units="millimolar"/>
        <variable name="C_O2_c_init" public_interface="in" units="millimolar"/>
        <variable name="C_O2_v" public_interface="out" units="millimolar"/>
        <variable name="P_O2_c" public_interface="out" units="mmHg"/>
        <variable name="P_CO2_c" public_interface="out" units="mmHg"/>
        <variable name="v_out" public_interface="in" units="m3_per_s"/>
        <variable name="L" public_interface="in" units="metre"/>
        <variable name="r" public_interface="in" units="metre"/>
        <variable name="V" public_interface="in" units="m3"/>
        <!-- unbound concentrations-->
        <variable name="ub_O2_c" public_interface="out" units="millimolar"/>
        <variable name="ub_O2_t" public_interface="in" units="millimolar"/>
        <variable name="ub_CO2_c" public_interface="out" units="millimolar"/>
        <!-- CO2 constant for now
 TODO improve this-->
        <variable name="C_CO2_c" public_interface="out" units="millimolar"/>
        <variable name="C_CO2_v" public_interface="out" units="millimolar"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_CO2_c</ci>
                <ci>C_CO2_a</ci>
            </apply>
            <!-- temporary-->
            <apply>
                <eq/>
                <ci>ub_CO2_v</ci>
                <ci>ub_CO2_c</ci>
            </apply>
        </math>
        <!-- permeability of capillary membrane constant-->
        <variable name="perm_O2" public_interface="in" units="m_per_s"/>
        <!-- solubility constants-->
        <variable name="S_O2" public_interface="in" units="mol_per_m3_per_Pa"/>
        <variable name="S_CO2" public_interface="in" units="mol_per_m3_per_Pa"/>
        <!-- exponential approx variables-->
        <variable name="alpha" public_interface="out" units="dimensionless"/>
        <variable name="W_pade_approx" public_interface="out" units="dimensionless"/>
        <variable name="k_xdecay" public_interface="out" units="per_m"/>
        <variable name="C_0" public_interface="out" units="dimensionless"/>
        <!-- flux to tissue-->
        <variable name="flux_O2_c" public_interface="out" units="mol_per_s"/>
        <variable name="D_O2" public_interface="out" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>D_O2</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">2</cn>
                    <pi/>
                    <ci>r</ci>
                    <ci>L</ci>
                    <ci>perm_O2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>flux_O2_c</ci>
                <apply>
                    <times/>
                    <ci>D_O2</ci>
                    <apply>
                        <minus/>
                        <ci>ub_O2_c</ci>
                        <ci>ub_O2_t</ci>
                    </apply>
                </apply>
            </apply>
            <!-- equation for O2 concentration-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_O2_c</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>v_in</ci>
                                <ci>C_O2_a</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>v_out</ci>
                                <ci>C_O2_v</ci>
                            </apply>
                        </apply>
                        <ci>flux_O2_c</ci>
                    </apply>
                    <ci>V</ci>
                </apply>
            </apply>
            <!-- calculate CO2_v from exponential decreasing concentration assumption.-->
            <apply>
                <eq/>
                <ci>C_0</ci>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <ci>C_O2_c</ci>
                        <ci>ub_O2_t</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>C_O2_a</ci>
                        <ci>ub_O2_t</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>alpha</ci>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <exp/>
                            <apply>
                                <divide/>
                                <apply>
                                    <minus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                </apply>
                                <ci>C_0</ci>
                            </apply>
                        </apply>
                    </apply>
                    <ci>C_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>W_pade_approx</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <ln/>
                            <apply>
                                <plus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>alpha</ci>
                            </apply>
                        </apply>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <apply>
                                    <divide/>
                                    <cn cellml:units="dimensionless">123</cn>
                                    <cn cellml:units="dimensionless">40</cn>
                                </apply>
                                <ci>alpha</ci>
                            </apply>
                            <apply>
                                <times/>
                                <apply>
                                    <divide/>
                                    <cn cellml:units="dimensionless">21</cn>
                                    <cn cellml:units="dimensionless">10</cn>
                                </apply>
                                <apply>
                                    <power/>
                                    <ci>alpha</ci>
                                    <cn cellml:units="dimensionless">2</cn>
                                </apply>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">143</cn>
                                <cn cellml:units="dimensionless">40</cn>
                            </apply>
                            <ci>alpha</ci>
                        </apply>
                        <apply>
                            <times/>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">713</cn>
                                <cn cellml:units="dimensionless">240</cn>
                            </apply>
                            <apply>
                                <power/>
                                <ci>alpha</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>k_xdecay</ci>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <ci>C_0</ci>
                            <ci>W_pade_approx</ci>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>C_0</ci>
                        <ci>L</ci>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- Now calculate the venous concentration-->
        <variable name="exp_threshold" public_interface="in" units="millimolar"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>ub_O2_v</ci>
                <piecewise>
                    <piece>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>ub_O2_a</ci>
                                    <ci>ub_O2_t</ci>
                                </apply>
                                <apply>
                                    <exp/>
                                    <apply>
                                        <times/>
                                        <apply>
                                            <minus/>
                                            <ci>k_xdecay</ci>
                                        </apply>
                                        <ci>L</ci>
                                    </apply>
                                </apply>
                            </apply>
                            <ci>ub_O2_t</ci>
                        </apply>
                        <apply>
                            <lt/>
                            <ci>ub_O2_c</ci>
                            <apply>
                                <times/>
                                <ci>exp_threshold</ci>
                                <ci>ub_O2_a</ci>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <ci>ub_O2_c</ci>
                            </apply>
                            <ci>ub_O2_a</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>ub_O2_c</ci>
                                <apply>
                                    <times/>
                                    <ci>exp_threshold</ci>
                                    <ci>ub_O2_a</ci>
                                </apply>
                            </apply>
                            <apply>
                                <lt/>
                                <ci>ub_O2_c</ci>
                                <ci>ub_O2_a</ci>
                            </apply>
                        </apply>
                    </piece>
                    <otherwise>
                        <ci>ub_O2_c</ci>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <!-- linear if C_O2_c is close.-->
        <!-- ===================================== inverted dissociation curves ======================================-->
        <variable name="k_1" public_interface="in" units="mmHg"/>
        <variable name="k_2" public_interface="in" units="mmHg"/>
        <variable name="a_1" public_interface="in" units="dimensionless"/>
        <variable name="a_2" public_interface="in" units="dimensionless"/>
        <variable name="d_1" public_interface="out" units="mmHg"/>
        <variable name="d_2" public_interface="out" units="mmHg"/>
        <variable name="r_1" public_interface="out" units="mmHg"/>
        <variable name="r_2" public_interface="out" units="mmHg"/>
        <variable name="s_1" public_interface="out" units="mmHg2"/>
        <variable name="s_2" public_interface="out" units="mmHg2"/>
        <variable name="alpha_1" public_interface="in" units="per_mmHg"/>
        <variable name="alpha_2" public_interface="in" units="per_mmHg"/>
        <variable name="beta_1" public_interface="in" units="per_mmHg"/>
        <variable name="beta_2" public_interface="in" units="per_mmHg"/>
        <variable name="C_O2_sat" public_interface="in" units="mol_per_m3"/>
        <variable name="C_CO2_sat" public_interface="in" units="mol_per_m3"/>
        <variable name="C_O2_c_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_c_capped" public_interface="out" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_c_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_O2_c</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_c_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_CO2_c</ci>
                </apply>
            </apply>
            <!-- curve equations-->
            <apply>
                <eq/>
                <ci>d_1</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_c_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_c_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_c_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_c_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- equations for pressures and unbound gas concentrations from inverted dissociation curve and solubility coefficients-->
            <apply>
                <eq/>
                <ci>P_O2_c</ci>
                <apply>
                    <plus/>
                    <ci>r_1</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_c</ci>
                <apply>
                    <plus/>
                    <ci>r_2</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_2</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_O2_c</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_O2_c</ci>
                    <ci>S_O2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_CO2_c</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_CO2_c</ci>
                    <ci>S_CO2</ci>
                </apply>
            </apply>
        </math>
        <!-- todo the below conversion for arterial shouldn't be done as it's calculated in the upstream module)-->
        <variable name="d_1_a" public_interface="out" units="mmHg"/>
        <variable name="d_2_a" public_interface="out" units="mmHg"/>
        <variable name="r_1_a" public_interface="out" units="mmHg"/>
        <variable name="r_2_a" public_interface="out" units="mmHg"/>
        <variable name="s_1_a" public_interface="out" units="mmHg2"/>
        <variable name="s_2_a" public_interface="out" units="mmHg2"/>
        <variable name="ub_O2_a" public_interface="out" units="mM"/>
        <variable name="ub_CO2_a" public_interface="out" units="mM"/>
        <variable name="P_O2_a" public_interface="out" units="mmHg"/>
        <variable name="P_CO2_a" public_interface="out" units="mmHg"/>
        <variable name="C_O2_a_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_a_capped" public_interface="out" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_a_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_O2_a</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_a_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_CO2_a</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_1_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_a_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_a_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_a_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_a_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2_a</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1_a</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1_a</ci>
                                <ci>d_2_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1_a</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2_a</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2_a</ci>
                                <ci>d_1_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1_a</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1_a</ci>
                                <ci>d_2_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2_a</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2_a</ci>
                                <ci>d_1_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_O2_a</ci>
                <apply>
                    <plus/>
                    <ci>r_1_a</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1_a</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_a</ci>
                <apply>
                    <plus/>
                    <ci>r_2_a</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_2_a</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_2_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_O2_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_O2_a</ci>
                    <ci>S_O2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_CO2_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_CO2_a</ci>
                    <ci>S_CO2</ci>
                </apply>
            </apply>
        </math>
        <!-- &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; dissociation curves for downstream content
 need to determine units for f_1 and f_2-->
        <variable name="f_1" public_interface="out" units="dimensionless"/>
        <variable name="f_2" public_interface="out" units="dimensionless"/>
        <variable name="P_O2_v" public_interface="out" units="mmHg"/>
        <variable name="P_CO2_v" public_interface="out" units="mmHg"/>
        <variable name="ub_O2_v" public_interface="out" units="mM"/>
        <variable name="ub_CO2_v" public_interface="out" units="mM"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>P_O2_v</ci>
                <apply>
                    <divide/>
                    <ci>ub_O2_v</ci>
                    <apply>
                        <times/>
                        <ci>S_O2</ci>
                        <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_v</ci>
                <apply>
                    <divide/>
                    <ci>ub_CO2_v</ci>
                    <apply>
                        <times/>
                        <ci>S_CO2</ci>
                        <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    </apply>
                </apply>
            </apply>
            <!-- curve equations-->
            <apply>
                <eq/>
                <ci>C_O2_v</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <apply>
                            <power/>
                            <ci>f_1</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <power/>
                            <ci>f_1</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_1</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_v</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <apply>
                            <power/>
                            <ci>f_2</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <power/>
                            <ci>f_2</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_2</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>f_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>P_O2_v</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>beta_1</ci>
                                <ci>P_CO2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>P_CO2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>f_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>P_CO2_v</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>beta_2</ci>
                                <ci>P_O2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>P_O2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- Only difference to below module below-->
        <variable name="v_in" public_interface="in" units="m3_per_s"/>
        <variable name="C_CO2_a" public_interface="in" units="millimolar"/>
        <variable name="C_O2_a" public_interface="in" units="millimolar"/>
    </component>
    <component name="capillary_GE_merge">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="C_O2_c_init" name="C_O2_c" public_interface="out" units="millimolar"/>
        <variable name="C_O2_c_init" public_interface="in" units="millimolar"/>
        <variable name="C_O2_v" public_interface="out" units="millimolar"/>
        <variable name="P_O2_c" public_interface="out" units="mmHg"/>
        <variable name="P_CO2_c" public_interface="out" units="mmHg"/>
        <variable name="v_out" public_interface="in" units="m3_per_s"/>
        <variable name="L" public_interface="in" units="metre"/>
        <variable name="r" public_interface="in" units="metre"/>
        <variable name="V" public_interface="in" units="m3"/>
        <!-- unbound concentrations-->
        <variable name="ub_O2_c" public_interface="out" units="millimolar"/>
        <variable name="ub_O2_t" public_interface="in" units="millimolar"/>
        <variable name="ub_CO2_c" public_interface="out" units="millimolar"/>
        <!-- CO2 constant for now
 TODO improve this-->
        <variable name="C_CO2_c" public_interface="out" units="millimolar"/>
        <variable name="C_CO2_v" public_interface="out" units="millimolar"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_CO2_c</ci>
                <ci>C_CO2_a</ci>
            </apply>
            <!-- temporary-->
            <apply>
                <eq/>
                <ci>ub_CO2_v</ci>
                <ci>ub_CO2_c</ci>
            </apply>
        </math>
        <!-- permeability of capillary membrane constant-->
        <variable name="perm_O2" public_interface="in" units="m_per_s"/>
        <!-- solubility constants-->
        <variable name="S_O2" public_interface="in" units="mol_per_m3_per_Pa"/>
        <variable name="S_CO2" public_interface="in" units="mol_per_m3_per_Pa"/>
        <!-- exponential approx variables-->
        <variable name="alpha" public_interface="out" units="dimensionless"/>
        <variable name="W_pade_approx" public_interface="out" units="dimensionless"/>
        <variable name="k_xdecay" public_interface="out" units="per_m"/>
        <variable name="C_0" public_interface="out" units="dimensionless"/>
        <!-- flux to tissue-->
        <variable name="flux_O2_c" public_interface="out" units="mol_per_s"/>
        <variable name="D_O2" public_interface="out" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>D_O2</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">2</cn>
                    <pi/>
                    <ci>r</ci>
                    <ci>L</ci>
                    <ci>perm_O2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>flux_O2_c</ci>
                <apply>
                    <times/>
                    <ci>D_O2</ci>
                    <apply>
                        <minus/>
                        <ci>ub_O2_c</ci>
                        <ci>ub_O2_t</ci>
                    </apply>
                </apply>
            </apply>
            <!-- equation for O2 concentration-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>C_O2_c</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>v_in</ci>
                                <ci>C_O2_a</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>v_out</ci>
                                <ci>C_O2_v</ci>
                            </apply>
                        </apply>
                        <ci>flux_O2_c</ci>
                    </apply>
                    <ci>V</ci>
                </apply>
            </apply>
            <!-- calculate CO2_v from exponential decreasing concentration assumption.-->
            <apply>
                <eq/>
                <ci>C_0</ci>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <ci>C_O2_c</ci>
                        <ci>ub_O2_t</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>C_O2_a</ci>
                        <ci>ub_O2_t</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>alpha</ci>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <exp/>
                            <apply>
                                <divide/>
                                <apply>
                                    <minus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                </apply>
                                <ci>C_0</ci>
                            </apply>
                        </apply>
                    </apply>
                    <ci>C_0</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>W_pade_approx</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <ln/>
                            <apply>
                                <plus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>alpha</ci>
                            </apply>
                        </apply>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <apply>
                                    <divide/>
                                    <cn cellml:units="dimensionless">123</cn>
                                    <cn cellml:units="dimensionless">40</cn>
                                </apply>
                                <ci>alpha</ci>
                            </apply>
                            <apply>
                                <times/>
                                <apply>
                                    <divide/>
                                    <cn cellml:units="dimensionless">21</cn>
                                    <cn cellml:units="dimensionless">10</cn>
                                </apply>
                                <apply>
                                    <power/>
                                    <ci>alpha</ci>
                                    <cn cellml:units="dimensionless">2</cn>
                                </apply>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">143</cn>
                                <cn cellml:units="dimensionless">40</cn>
                            </apply>
                            <ci>alpha</ci>
                        </apply>
                        <apply>
                            <times/>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">713</cn>
                                <cn cellml:units="dimensionless">240</cn>
                            </apply>
                            <apply>
                                <power/>
                                <ci>alpha</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>k_xdecay</ci>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <times/>
                            <ci>C_0</ci>
                            <ci>W_pade_approx</ci>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>C_0</ci>
                        <ci>L</ci>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- Now calculate the venous concentration-->
        <variable name="exp_threshold" public_interface="in" units="millimolar"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>ub_O2_v</ci>
                <piecewise>
                    <piece>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>ub_O2_a</ci>
                                    <ci>ub_O2_t</ci>
                                </apply>
                                <apply>
                                    <exp/>
                                    <apply>
                                        <times/>
                                        <apply>
                                            <minus/>
                                            <ci>k_xdecay</ci>
                                        </apply>
                                        <ci>L</ci>
                                    </apply>
                                </apply>
                            </apply>
                            <ci>ub_O2_t</ci>
                        </apply>
                        <apply>
                            <lt/>
                            <ci>ub_O2_c</ci>
                            <apply>
                                <times/>
                                <ci>exp_threshold</ci>
                                <ci>ub_O2_a</ci>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <ci>ub_O2_c</ci>
                            </apply>
                            <ci>ub_O2_a</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>ub_O2_c</ci>
                                <apply>
                                    <times/>
                                    <ci>exp_threshold</ci>
                                    <ci>ub_O2_a</ci>
                                </apply>
                            </apply>
                            <apply>
                                <lt/>
                                <ci>ub_O2_c</ci>
                                <ci>ub_O2_a</ci>
                            </apply>
                        </apply>
                    </piece>
                    <otherwise>
                        <ci>ub_O2_c</ci>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <!-- linear if C_O2_c is close.-->
        <!-- ===================================== inverted dissociation curves ======================================-->
        <variable name="k_1" public_interface="in" units="mmHg"/>
        <variable name="k_2" public_interface="in" units="mmHg"/>
        <variable name="a_1" public_interface="in" units="dimensionless"/>
        <variable name="a_2" public_interface="in" units="dimensionless"/>
        <variable name="d_1" public_interface="out" units="mmHg"/>
        <variable name="d_2" public_interface="out" units="mmHg"/>
        <variable name="r_1" public_interface="out" units="mmHg"/>
        <variable name="r_2" public_interface="out" units="mmHg"/>
        <variable name="s_1" public_interface="out" units="mmHg2"/>
        <variable name="s_2" public_interface="out" units="mmHg2"/>
        <variable name="alpha_1" public_interface="in" units="per_mmHg"/>
        <variable name="alpha_2" public_interface="in" units="per_mmHg"/>
        <variable name="beta_1" public_interface="in" units="per_mmHg"/>
        <variable name="beta_2" public_interface="in" units="per_mmHg"/>
        <variable name="C_O2_sat" public_interface="in" units="mol_per_m3"/>
        <variable name="C_CO2_sat" public_interface="in" units="mol_per_m3"/>
        <variable name="C_O2_c_capped" public_interface="out" units="dimensionless"/>
        <variable name="C_CO2_c_capped" public_interface="out" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>C_O2_c_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_O2_c</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_c_capped</ci>
                <apply>
                    <min/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <ci>saturation_cap</ci>
                    </apply>
                    <ci>C_CO2_c</ci>
                </apply>
            </apply>
            <!-- curve equations-->
            <apply>
                <eq/>
                <ci>d_1</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_c_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_c_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_c_capped</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_c_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1</ci>
                                <ci>d_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2</ci>
                                <ci>d_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- equations for pressures and unbound gas concentrations from inverted dissociation curve and solubility coefficients-->
            <apply>
                <eq/>
                <ci>P_O2_c</ci>
                <apply>
                    <plus/>
                    <ci>r_1</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_c</ci>
                <apply>
                    <plus/>
                    <ci>r_2</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_2</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_2</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_O2_c</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_O2_c</ci>
                    <ci>S_O2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_CO2_c</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_CO2_c</ci>
                    <ci>S_CO2</ci>
                </apply>
            </apply>
        </math>
        <!-- todo the below conversion for arterial shouldn't be done as it's calculated in the upstream module)-->
        <variable name="d_1_a" public_interface="out" units="mmHg"/>
        <variable name="d_2_a" public_interface="out" units="mmHg"/>
        <variable name="r_1_a" public_interface="out" units="mmHg"/>
        <variable name="r_2_a" public_interface="out" units="mmHg"/>
        <variable name="s_1_a" public_interface="out" units="mmHg2"/>
        <variable name="s_2_a" public_interface="out" units="mmHg2"/>
        <variable name="ub_O2_a" public_interface="out" units="mM"/>
        <variable name="ub_CO2_a" public_interface="out" units="mM"/>
        <variable name="P_O2_a" public_interface="out" units="mmHg"/>
        <variable name="P_CO2_a" public_interface="out" units="mmHg"/>
        <!--var C_O2_a_capped: dimensionless {pub: out};
var C_CO2_a_capped: dimensionless {pub: out};
C_O2_a_capped = min(C_O2_sat*saturation_cap, C_O2_a);
C_CO2_a_capped = min(C_CO2_sat*saturation_cap, C_CO2_a);-->
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>d_1_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_O2_a</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_O2_sat</ci>
                                    <ci>C_O2_a_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_1</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>d_2_a</ci>
                <apply>
                    <max/>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <power/>
                            <apply>
                                <divide/>
                                <ci>C_CO2_a</ci>
                                <apply>
                                    <minus/>
                                    <ci>C_CO2_sat</ci>
                                    <ci>C_CO2_a_capped</ci>
                                </apply>
                            </apply>
                            <ci>a_2</ci>
                        </apply>
                    </apply>
                    <cn cellml:units="J_per_m3">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_1_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_1</ci>
                                        <ci>d_2_a</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_2</ci>
                                    <ci>d_1_a</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>alpha_2</ci>
                                <ci>d_1_a</ci>
                                <ci>d_2_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>r_2_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                        <apply>
                            <minus/>
                            <apply>
                                <minus/>
                                <apply>
                                    <plus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <times/>
                                        <ci>beta_2</ci>
                                        <ci>d_1_a</ci>
                                    </apply>
                                </apply>
                                <apply>
                                    <times/>
                                    <ci>beta_1</ci>
                                    <ci>d_2_a</ci>
                                </apply>
                            </apply>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>alpha_1</ci>
                                <ci>d_2_a</ci>
                                <ci>d_1_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_1_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_1_a</ci>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>d_1_a</ci>
                                <ci>d_2_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_2</ci>
                        <apply>
                            <times/>
                            <ci>alpha_2</ci>
                            <ci>beta_1</ci>
                            <ci>d_2_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>s_2_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <cn cellml:units="dimensionless">1</cn>
                        </apply>
                        <apply>
                            <plus/>
                            <ci>d_2_a</ci>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>d_2_a</ci>
                                <ci>d_1_a</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>beta_1</ci>
                        <apply>
                            <times/>
                            <ci>alpha_1</ci>
                            <ci>beta_2</ci>
                            <ci>d_1_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_O2_a</ci>
                <apply>
                    <plus/>
                    <ci>r_1_a</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_1_a</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_1_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_a</ci>
                <apply>
                    <plus/>
                    <ci>r_2_a</ci>
                    <apply>
                        <root/>
                        <apply>
                            <minus/>
                            <apply>
                                <power/>
                                <ci>r_2_a</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                            <ci>s_2_a</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_O2_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_O2_a</ci>
                    <ci>S_O2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>ub_CO2_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    <ci>P_CO2_a</ci>
                    <ci>S_CO2</ci>
                </apply>
            </apply>
        </math>
        <!-- &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; dissociation curves for downstream content
 need to determine units for f_1 and f_2-->
        <variable name="f_1" public_interface="out" units="dimensionless"/>
        <variable name="f_2" public_interface="out" units="dimensionless"/>
        <variable name="P_O2_v" public_interface="out" units="mmHg"/>
        <variable name="P_CO2_v" public_interface="out" units="mmHg"/>
        <variable name="ub_O2_v" public_interface="out" units="mM"/>
        <variable name="ub_CO2_v" public_interface="out" units="mM"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>P_O2_v</ci>
                <apply>
                    <divide/>
                    <ci>ub_O2_v</ci>
                    <apply>
                        <times/>
                        <ci>S_O2</ci>
                        <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>P_CO2_v</ci>
                <apply>
                    <divide/>
                    <ci>ub_CO2_v</ci>
                    <apply>
                        <times/>
                        <ci>S_CO2</ci>
                        <cn cellml:units="Pa_per_mmHg">133.32</cn>
                    </apply>
                </apply>
            </apply>
            <!-- curve equations-->
            <apply>
                <eq/>
                <ci>C_O2_v</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>C_O2_sat</ci>
                        <apply>
                            <power/>
                            <ci>f_1</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_1</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <power/>
                            <ci>f_1</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_1</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_v</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>C_CO2_sat</ci>
                        <apply>
                            <power/>
                            <ci>f_2</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_2</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <power/>
                            <ci>f_2</ci>
                            <apply>
                                <divide/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>a_2</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>f_1</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>P_O2_v</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>beta_1</ci>
                                <ci>P_CO2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>k_1</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_1</ci>
                                <ci>P_CO2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>f_2</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>P_CO2_v</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>beta_2</ci>
                                <ci>P_O2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                    <apply>
                        <times/>
                        <ci>k_2</ci>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless">1</cn>
                            <apply>
                                <times/>
                                <ci>alpha_2</ci>
                                <ci>P_O2_v</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-Only difference to above module below &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-//
 average the incoming concentrations-->
        <variable initial_value="1e-28" name="eps" units="m3_per_s"/>
        <variable name="v_in_1" public_interface="in" units="m3_per_s"/>
        <variable name="v_in_2" public_interface="in" units="m3_per_s"/>
        <variable name="v_in" public_interface="out" units="m3_per_s"/>
        <variable name="C_O2_a" public_interface="out" units="millimolar"/>
        <variable name="C_O2_a_1" public_interface="in" units="millimolar"/>
        <variable name="C_O2_a_2" public_interface="in" units="millimolar"/>
        <variable name="C_CO2_a" public_interface="out" units="millimolar"/>
        <variable name="C_CO2_a_1" public_interface="in" units="millimolar"/>
        <variable name="C_CO2_a_2" public_interface="in" units="millimolar"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>v_in</ci>
                <apply>
                    <plus/>
                    <ci>v_in_1</ci>
                    <ci>v_in_2</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_O2_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <apply>
                                <abs/>
                                <ci>v_in_1</ci>
                            </apply>
                            <ci>C_O2_a_1</ci>
                        </apply>
                        <apply>
                            <times/>
                            <apply>
                                <abs/>
                                <ci>v_in_2</ci>
                            </apply>
                            <ci>C_O2_a_2</ci>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <apply>
                            <abs/>
                            <ci>v_in</ci>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_CO2_a</ci>
                <apply>
                    <divide/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <apply>
                                <abs/>
                                <ci>v_in_1</ci>
                            </apply>
                            <ci>C_CO2_a_1</ci>
                        </apply>
                        <apply>
                            <times/>
                            <apply>
                                <abs/>
                                <ci>v_in_2</ci>
                            </apply>
                            <ci>C_CO2_a_2</ci>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <apply>
                            <abs/>
                            <ci>v_in</ci>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
</model>
