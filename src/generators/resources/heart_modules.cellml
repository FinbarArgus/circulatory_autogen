<?xml version='1.0' encoding='UTF-8'?>
<model name="modules" xmlns="http://www.cellml.org/cellml/1.1#" xmlns:cellml="http://www.cellml.org/cellml/1.1#">
    <component name="heart_simple_wCont">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="0.0" name="s" public_interface="out" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="mt" units="second"/>
        <variable name="e_a" units="dimensionless"/>
        <variable name="e_v" units="dimensionless"/>
        <variable name="T" public_interface="in" units="second"/>
        <variable name="T_ac" public_interface="in" units="second"/>
        <variable name="T_ar" public_interface="in" units="second"/>
        <!-- var T_ac_norm: dimensionless;
 var T_ar_norm: dimensionless;-->
        <variable name="t_astart" public_interface="in" units="second"/>
        <variable name="t_astart_norm" units="dimensionless"/>
        <variable name="T_vc" public_interface="in" units="second"/>
        <variable name="T_vr" public_interface="in" units="second"/>
        <!-- var T_vc_norm: dimensionless;
 var T_vr_norm: dimensionless;-->
        <variable name="t_vstart" public_interface="in" units="second"/>
        <variable name="t_vstart_norm" units="dimensionless"/>
        <variable name="T_wCont" public_interface="out" units="second"/>
        <variable name="T_ac_wCont" public_interface="out" units="second"/>
        <variable name="T_ar_wCont" public_interface="out" units="second"/>
        <variable name="T_vc_wCont" public_interface="out" units="second"/>
        <variable name="T_vr_wCont" public_interface="out" units="second"/>
        <variable name="E_lv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_lv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_B" public_interface="in" units="J_per_m6"/>
        <variable name="q_ra_0" public_interface="in" units="m3"/>
        <variable name="q_rv_0" public_interface="in" units="m3"/>
        <variable name="q_la_0" public_interface="in" units="m3"/>
        <variable name="q_lv_0" public_interface="in" units="m3"/>
        <!-- State Variables-->
        <variable name="u_ra" public_interface="out" units="J_per_m3"/>
        <variable name="u_rv" units="J_per_m3"/>
        <variable name="u_la" public_interface="out" units="J_per_m3"/>
        <variable name="u_lv" units="J_per_m3"/>
        <variable name="u_root" public_interface="in" units="J_per_m3"/>
        <variable name="u_par" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0" name="v_trv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_puv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_miv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_aov" public_interface="out" units="m3_per_s"/>
        <variable name="v_svc" public_interface="in" units="m3_per_s"/>
        <variable name="v_ivc" public_interface="in" units="m3_per_s"/>
        <variable name="v_pvn" public_interface="in" units="m3_per_s"/>
        <variable name="L_trv" units="dimensionless"/>
        <variable name="L_puv" units="dimensionless"/>
        <variable name="L_miv" units="dimensionless"/>
        <variable name="L_aov" units="dimensionless"/>
        <variable name="A_eff_trv" units="m2"/>
        <variable name="A_eff_puv" units="m2"/>
        <variable name="A_eff_miv" units="m2"/>
        <variable name="A_eff_aov" units="m2"/>
        <variable name="A_nn_trv" public_interface="in" units="m2"/>
        <variable name="A_nn_puv" public_interface="in" units="m2"/>
        <variable name="A_nn_miv" public_interface="in" units="m2"/>
        <variable name="A_nn_aov" public_interface="in" units="m2"/>
        <variable name="l_eff" public_interface="in" units="metre"/>
        <variable name="K_vo_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="M_rg_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_aov" public_interface="in" units="dimensionless"/>
        <variable name="M_st_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_aov" public_interface="in" units="dimensionless"/>
        <variable name="rho" public_interface="in" units="Js2_per_m5"/>
        <variable name="B_trv" units="dimensionless"/>
        <variable name="B_puv" units="dimensionless"/>
        <variable name="B_miv" units="dimensionless"/>
        <variable name="B_aov" units="dimensionless"/>
        <variable name="zeta_trv" units="dimensionless"/>
        <variable name="zeta_puv" units="dimensionless"/>
        <variable name="zeta_miv" units="dimensionless"/>
        <variable name="zeta_aov" units="dimensionless"/>
        <variable initial_value="0" name="zeta_trv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_puv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_miv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_aov_pre" units="dimensionless"/>
        <variable initial_value="1e-14" name="eps" units="dimensionless"/>
        <variable initial_value="0.07" name="eps_1" units="dimensionless"/>
        <variable initial_value="0.02" name="eps_2" units="dimensionless"/>
        <!-- TODO the below parameters should be set in an init_states parameter file
 q_lv gets identified, the others are set arbitrarily, identifying q_lv sets the stressed volume of the system.-->
        <variable initial_value="0.00069934" name="q_lv" units="m3"/>
        <variable initial_value="1e-05" name="q_rv" units="m3"/>
        <variable initial_value="4e-06" name="q_la" units="m3"/>
        <variable initial_value="4e-06" name="q_ra" units="m3"/>
        <!-- calculate modified time due to changes in heart period. This can now be modified throughout a simulation.-->
        <variable initial_value="0.0" name="chi_a" units="dimensionless"/>
        <variable name="chi_afloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_afloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_a</ci>
                    <apply>
                        <floor/>
                        <ci>chi_a</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_a</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac_wCont</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_astart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac_wCont</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_astart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac_wCont</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_afloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ar_wCont</ci>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <variable initial_value="0.0" name="chi_v" units="dimensionless"/>
        <variable name="chi_vfloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_vfloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_v</ci>
                    <apply>
                        <floor/>
                        <ci>chi_v</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_v</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc_wCont</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_vstart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc_wCont</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_vstart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc_wCont</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vr_wCont</ci>
                        </apply>
                        <apply>
                            <gt/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>s</ci>
                </apply>
                <apply>
                    <divide/>
                    <cn cellml:units="second">1</cn>
                    <ci>T_wCont</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>mt</ci>
                <apply>
                    <minus/>
                    <ci>s</ci>
                    <apply>
                        <floor/>
                        <ci>s</ci>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- control effects Assume all subperiods scale linearly for now. TODO IMPROVE THIS-->
        <variable name="Delta_T" public_interface="in" units="second"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>T_wCont</ci>
                <apply>
                    <plus/>
                    <ci>T</ci>
                    <ci>Delta_T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ac_wCont</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>T_ac</ci>
                        <ci>T_wCont</ci>
                    </apply>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ar_wCont</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>T_ar</ci>
                        <ci>T_wCont</ci>
                    </apply>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vc_wCont</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>T_vc</ci>
                        <ci>T_wCont</ci>
                    </apply>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vr_wCont</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>T_vr</ci>
                        <ci>T_wCont</ci>
                    </apply>
                    <ci>T</ci>
                </apply>
            </apply>
            <!-- Elastance Functions-->
            <apply>
                <eq/>
                <ci>t_astart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_astart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <!-- T_ac_norm = T_ac/T;
 T_ar_norm = T_vc/T;-->
            <apply>
                <eq/>
                <ci>t_vstart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_vstart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <!-- T_vc_norm = T_vc/T;
 T_vr_norm = T_vr/T;-->
            <apply>
                <eq/>
                <ci>e_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_afloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_v</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_vfloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- Valve model-->
            <apply>
                <eq/>
                <ci>B_trv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_trv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_puv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_miv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_aov</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_aov</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_aov</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_trv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_trv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_trv</ci>
                        <ci>A_nn_trv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_puv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_puv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_puv</ci>
                        <ci>A_nn_puv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_miv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_miv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_miv</ci>
                        <ci>A_nn_miv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_aov</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                        </apply>
                        <ci>zeta_aov</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_aov</ci>
                        <ci>A_nn_aov</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_trv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_trv_pre</ci>
                            </apply>
                            <ci>K_vo_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_ra</ci>
                            <ci>u_rv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_trv_pre</ci>
                            <ci>K_vc_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_puv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_puv_pre</ci>
                            </apply>
                            <ci>K_vo_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_rv</ci>
                            <ci>u_par</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_puv_pre</ci>
                            <ci>K_vc_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_miv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_miv_pre</ci>
                            </apply>
                            <ci>K_vo_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_la</ci>
                            <ci>u_lv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_miv_pre</ci>
                            <ci>K_vc_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_aov_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_aov_pre</ci>
                            </apply>
                            <ci>K_vo_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_lv</ci>
                            <ci>u_root</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_aov_pre</ci>
                            <ci>K_vc_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <!-- The below ensures zeta can't be negative-->
            <apply>
                <eq/>
                <ci>zeta_trv</ci>
                <apply>
                    <max/>
                    <ci>zeta_trv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_puv</ci>
                <apply>
                    <max/>
                    <ci>zeta_puv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_miv</ci>
                <apply>
                    <max/>
                    <ci>zeta_miv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_aov</ci>
                <apply>
                    <max/>
                    <ci>zeta_aov_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <!-- calculate the flow through the valves-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_trv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_trv</ci>
                                </apply>
                                <ci>v_trv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_trv</ci>
                                </apply>
                            </apply>
                            <ci>u_ra</ci>
                        </apply>
                        <ci>u_rv</ci>
                    </apply>
                    <ci>L_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_puv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_puv</ci>
                                </apply>
                                <ci>v_puv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_puv</ci>
                                </apply>
                            </apply>
                            <ci>u_rv</ci>
                        </apply>
                        <ci>u_par</ci>
                    </apply>
                    <ci>L_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_miv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_miv</ci>
                                </apply>
                                <ci>v_miv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_miv</ci>
                                </apply>
                            </apply>
                            <ci>u_la</ci>
                        </apply>
                        <ci>u_lv</ci>
                    </apply>
                    <ci>L_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_aov</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_aov</ci>
                                </apply>
                                <ci>v_aov</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_aov</ci>
                                </apply>
                            </apply>
                            <ci>u_lv</ci>
                        </apply>
                        <ci>u_root</ci>
                    </apply>
                    <ci>L_aov</ci>
                </apply>
            </apply>
        </math>
        <!-- Control from sympathetic-->
        <variable name="E_rv_A_wCont" public_interface="out" units="J_per_m6"/>
        <variable name="E_lv_A_wCont" public_interface="out" units="J_per_m6"/>
        <!-- TODO The current control modifies the E_max-E_min instead of E_max.-->
        <variable name="Delta_E_rv" public_interface="in" units="J_per_m6"/>
        <variable name="Delta_E_lv" public_interface="in" units="J_per_m6"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>E_rv_A_wCont</ci>
                <apply>
                    <plus/>
                    <ci>E_rv_A</ci>
                    <ci>Delta_E_rv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>E_lv_A_wCont</ci>
                <apply>
                    <plus/>
                    <ci>E_lv_A</ci>
                    <ci>Delta_E_lv</ci>
                </apply>
            </apply>
            <!-- Constitutive Relations-->
            <apply>
                <eq/>
                <ci>u_ra</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_ra_A</ci>
                        </apply>
                        <ci>E_ra_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_ra</ci>
                        <ci>q_ra_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_rv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_rv_A_wCont</ci>
                        </apply>
                        <ci>E_rv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_rv</ci>
                        <ci>q_rv_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_la</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_la_A</ci>
                        </apply>
                        <ci>E_la_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_la</ci>
                        <ci>q_la_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_lv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_lv_A_wCont</ci>
                        </apply>
                        <ci>E_lv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_lv</ci>
                        <ci>q_lv_0</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_ra</ci>
                </apply>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>v_svc</ci>
                        <ci>v_ivc</ci>
                    </apply>
                    <ci>v_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_rv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_trv</ci>
                    <ci>v_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_la</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_pvn</ci>
                    <ci>v_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_lv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_miv</ci>
                    <ci>v_aov</ci>
                </apply>
            </apply>
        </math>
    </component>
    <component name="heart_simple">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="0.0" name="s" public_interface="out" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="mt" units="second"/>
        <variable name="e_a" units="dimensionless"/>
        <variable name="e_v" units="dimensionless"/>
        <variable name="T" public_interface="in" units="second"/>
        <variable name="T_ac" public_interface="in" units="second"/>
        <variable name="T_ar" public_interface="in" units="second"/>
        <variable name="T_ac_norm" units="dimensionless"/>
        <variable name="T_ar_norm" units="dimensionless"/>
        <variable name="t_astart" public_interface="in" units="second"/>
        <variable name="t_astart_norm" units="dimensionless"/>
        <variable name="T_vc" public_interface="in" units="second"/>
        <variable name="T_vr" public_interface="in" units="second"/>
        <variable name="T_vc_norm" units="dimensionless"/>
        <variable name="T_vr_norm" units="dimensionless"/>
        <variable name="t_vstart" public_interface="in" units="second"/>
        <variable name="t_vstart_norm" units="dimensionless"/>
        <variable name="E_lv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_lv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_B" public_interface="in" units="J_per_m6"/>
        <variable name="q_ra_0" public_interface="in" units="m3"/>
        <variable name="q_rv_0" public_interface="in" units="m3"/>
        <variable name="q_la_0" public_interface="in" units="m3"/>
        <variable name="q_lv_0" public_interface="in" units="m3"/>
        <!-- State Variables-->
        <variable name="u_ra" public_interface="out" units="J_per_m3"/>
        <variable name="u_rv" units="J_per_m3"/>
        <variable name="u_la" public_interface="out" units="J_per_m3"/>
        <variable name="u_lv" units="J_per_m3"/>
        <variable name="u_root" public_interface="in" units="J_per_m3"/>
        <variable name="u_par" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0" name="v_trv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_puv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_miv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_aov" public_interface="out" units="m3_per_s"/>
        <variable name="v_svc" public_interface="in" units="m3_per_s"/>
        <variable name="v_ivc" public_interface="in" units="m3_per_s"/>
        <variable name="v_pvn" public_interface="in" units="m3_per_s"/>
        <variable name="L_trv" units="dimensionless"/>
        <variable name="L_puv" units="dimensionless"/>
        <variable name="L_miv" units="dimensionless"/>
        <variable name="L_aov" units="dimensionless"/>
        <variable name="A_eff_trv" units="m2"/>
        <variable name="A_eff_puv" units="m2"/>
        <variable name="A_eff_miv" units="m2"/>
        <variable name="A_eff_aov" units="m2"/>
        <variable name="A_nn_trv" public_interface="in" units="m2"/>
        <variable name="A_nn_puv" public_interface="in" units="m2"/>
        <variable name="A_nn_miv" public_interface="in" units="m2"/>
        <variable name="A_nn_aov" public_interface="in" units="m2"/>
        <variable name="l_eff" public_interface="in" units="metre"/>
        <variable name="K_vo_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="M_rg_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_aov" public_interface="in" units="dimensionless"/>
        <variable name="M_st_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_aov" public_interface="in" units="dimensionless"/>
        <variable name="rho" public_interface="in" units="Js2_per_m5"/>
        <variable name="B_trv" units="dimensionless"/>
        <variable name="B_puv" units="dimensionless"/>
        <variable name="B_miv" units="dimensionless"/>
        <variable name="B_aov" units="dimensionless"/>
        <variable name="zeta_trv" units="dimensionless"/>
        <variable name="zeta_puv" units="dimensionless"/>
        <variable name="zeta_miv" units="dimensionless"/>
        <variable name="zeta_aov" units="dimensionless"/>
        <variable initial_value="0" name="zeta_trv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_puv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_miv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_aov_pre" units="dimensionless"/>
        <variable initial_value="1e-14" name="eps" units="dimensionless"/>
        <variable initial_value="0.07" name="eps_1" units="dimensionless"/>
        <variable initial_value="0.02" name="eps_2" units="dimensionless"/>
        <!-- TODO the below parameters should be set in an init_states parameter file
 q_lv gets identified, the others are set arbitrarily, identifying q_lv sets the stressed volume of the system.-->
        <variable initial_value="0.00069934" name="q_lv" units="m3"/>
        <variable initial_value="1e-05" name="q_rv" units="m3"/>
        <variable initial_value="4e-06" name="q_la" units="m3"/>
        <variable initial_value="4e-06" name="q_ra" units="m3"/>
        <!-- calculate modified time due to changes in heart period. This can now be modified throughout a simulation.-->
        <variable initial_value="0.0" name="chi_a" units="dimensionless"/>
        <variable name="chi_afloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_afloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_a</ci>
                    <apply>
                        <floor/>
                        <ci>chi_a</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_a</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_astart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_astart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_afloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ar</ci>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <variable initial_value="0.0" name="chi_v" units="dimensionless"/>
        <variable name="chi_vfloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_vfloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_v</ci>
                    <apply>
                        <floor/>
                        <ci>chi_v</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_v</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_vstart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_vstart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vr</ci>
                        </apply>
                        <apply>
                            <gt/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>s</ci>
                </apply>
                <apply>
                    <divide/>
                    <cn cellml:units="second">1</cn>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>mt</ci>
                <apply>
                    <minus/>
                    <ci>s</ci>
                    <apply>
                        <floor/>
                        <ci>s</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Elastance Functions-->
            <apply>
                <eq/>
                <ci>t_astart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_astart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ac_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_ac</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ar_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>t_vstart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_vstart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vc_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vr_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vr</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_afloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_v</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_vfloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- Valve model-->
            <apply>
                <eq/>
                <ci>B_trv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_trv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_puv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_miv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_aov</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_aov</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_aov</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_trv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_trv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_trv</ci>
                        <ci>A_nn_trv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_puv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_puv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_puv</ci>
                        <ci>A_nn_puv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_miv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_miv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_miv</ci>
                        <ci>A_nn_miv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_aov</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                        </apply>
                        <ci>zeta_aov</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_aov</ci>
                        <ci>A_nn_aov</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_trv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_trv_pre</ci>
                            </apply>
                            <ci>K_vo_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_ra</ci>
                            <ci>u_rv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_trv_pre</ci>
                            <ci>K_vc_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_puv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_puv_pre</ci>
                            </apply>
                            <ci>K_vo_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_rv</ci>
                            <ci>u_par</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_puv_pre</ci>
                            <ci>K_vc_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_miv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_miv_pre</ci>
                            </apply>
                            <ci>K_vo_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_la</ci>
                            <ci>u_lv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_miv_pre</ci>
                            <ci>K_vc_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_aov_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_aov_pre</ci>
                            </apply>
                            <ci>K_vo_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_lv</ci>
                            <ci>u_root</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_aov_pre</ci>
                            <ci>K_vc_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <!-- The below ensures zeta can't be negative-->
            <apply>
                <eq/>
                <ci>zeta_trv</ci>
                <apply>
                    <max/>
                    <ci>zeta_trv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_puv</ci>
                <apply>
                    <max/>
                    <ci>zeta_puv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_miv</ci>
                <apply>
                    <max/>
                    <ci>zeta_miv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_aov</ci>
                <apply>
                    <max/>
                    <ci>zeta_aov_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <!-- calculate the flow through the valves-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_trv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_trv</ci>
                                </apply>
                                <ci>v_trv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_trv</ci>
                                </apply>
                            </apply>
                            <ci>u_ra</ci>
                        </apply>
                        <ci>u_rv</ci>
                    </apply>
                    <ci>L_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_puv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_puv</ci>
                                </apply>
                                <ci>v_puv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_puv</ci>
                                </apply>
                            </apply>
                            <ci>u_rv</ci>
                        </apply>
                        <ci>u_par</ci>
                    </apply>
                    <ci>L_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_miv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_miv</ci>
                                </apply>
                                <ci>v_miv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_miv</ci>
                                </apply>
                            </apply>
                            <ci>u_la</ci>
                        </apply>
                        <ci>u_lv</ci>
                    </apply>
                    <ci>L_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_aov</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_aov</ci>
                                </apply>
                                <ci>v_aov</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_aov</ci>
                                </apply>
                            </apply>
                            <ci>u_lv</ci>
                        </apply>
                        <ci>u_root</ci>
                    </apply>
                    <ci>L_aov</ci>
                </apply>
            </apply>
            <!-- Constitutive Relations-->
            <apply>
                <eq/>
                <ci>u_ra</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_ra_A</ci>
                        </apply>
                        <ci>E_ra_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_ra</ci>
                        <ci>q_ra_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_rv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_rv_A</ci>
                        </apply>
                        <ci>E_rv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_rv</ci>
                        <ci>q_rv_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_la</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_la_A</ci>
                        </apply>
                        <ci>E_la_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_la</ci>
                        <ci>q_la_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_lv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_lv_A</ci>
                        </apply>
                        <ci>E_lv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_lv</ci>
                        <ci>q_lv_0</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_ra</ci>
                </apply>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>v_svc</ci>
                        <ci>v_ivc</ci>
                    </apply>
                    <ci>v_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_rv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_trv</ci>
                    <ci>v_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_la</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_pvn</ci>
                    <ci>v_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_lv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_miv</ci>
                    <ci>v_aov</ci>
                </apply>
            </apply>
        </math>
    </component>
    <component name="heart_new_valve">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="0.0" name="s" public_interface="out" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="mt" units="second"/>
        <variable name="e_a" units="dimensionless"/>
        <variable name="e_v" units="dimensionless"/>
        <variable name="T" public_interface="in" units="second"/>
        <variable name="T_ac" public_interface="in" units="second"/>
        <variable name="T_ar" public_interface="in" units="second"/>
        <variable name="T_ac_norm" units="dimensionless"/>
        <variable name="T_ar_norm" units="dimensionless"/>
        <variable name="t_astart" public_interface="in" units="second"/>
        <variable name="t_astart_norm" units="dimensionless"/>
        <variable name="T_vc" public_interface="in" units="second"/>
        <variable name="T_vr" public_interface="in" units="second"/>
        <variable name="T_vc_norm" units="dimensionless"/>
        <variable name="T_vr_norm" units="dimensionless"/>
        <variable name="t_vstart" public_interface="in" units="second"/>
        <variable name="t_vstart_norm" units="dimensionless"/>
        <variable name="E_lv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_lv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_B" public_interface="in" units="J_per_m6"/>
        <variable name="q_ra_0" public_interface="in" units="m3"/>
        <variable name="q_rv_0" public_interface="in" units="m3"/>
        <variable name="q_la_0" public_interface="in" units="m3"/>
        <variable name="q_lv_0" public_interface="in" units="m3"/>
        <!-- State Variables-->
        <variable name="u_ra" public_interface="out" units="J_per_m3"/>
        <variable name="u_rv" units="J_per_m3"/>
        <variable name="u_la" public_interface="out" units="J_per_m3"/>
        <variable name="u_lv" units="J_per_m3"/>
        <variable name="u_root" public_interface="in" units="J_per_m3"/>
        <variable name="u_par" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0" name="v_trv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_puv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_miv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_aov" public_interface="out" units="m3_per_s"/>
        <variable name="v_svc" public_interface="in" units="m3_per_s"/>
        <variable name="v_ivc" public_interface="in" units="m3_per_s"/>
        <variable name="v_pvn" public_interface="in" units="m3_per_s"/>
        <variable name="L_trv" units="dimensionless"/>
        <variable name="L_puv" units="dimensionless"/>
        <variable name="L_miv" units="dimensionless"/>
        <variable name="L_aov" units="dimensionless"/>
        <variable name="A_eff_trv" units="m2"/>
        <variable name="A_eff_puv" units="m2"/>
        <variable name="A_eff_miv" units="m2"/>
        <variable name="A_eff_aov" units="m2"/>
        <variable name="A_nn_trv" public_interface="in" units="m2"/>
        <variable name="A_nn_puv" public_interface="in" units="m2"/>
        <variable name="A_nn_miv" public_interface="in" units="m2"/>
        <variable name="A_nn_aov" public_interface="in" units="m2"/>
        <variable name="l_eff" public_interface="in" units="metre"/>
        <variable name="K_vo_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="M_rg_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_aov" public_interface="in" units="dimensionless"/>
        <variable name="M_st_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_aov" public_interface="in" units="dimensionless"/>
        <variable name="rho" public_interface="in" units="Js2_per_m5"/>
        <variable name="B_trv" units="dimensionless"/>
        <variable name="B_puv" units="dimensionless"/>
        <variable name="B_miv" units="dimensionless"/>
        <variable name="B_aov" units="dimensionless"/>
        <variable name="zeta_trv" units="dimensionless"/>
        <variable name="zeta_puv" units="dimensionless"/>
        <variable name="zeta_miv" units="dimensionless"/>
        <variable name="zeta_aov" units="dimensionless"/>
        <variable initial_value="0" name="zeta_trv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_puv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_miv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_aov_pre" units="dimensionless"/>
        <variable initial_value="1e-14" name="eps" units="dimensionless"/>
        <variable initial_value="0.07" name="eps_1" units="dimensionless"/>
        <variable initial_value="0.02" name="eps_2" units="dimensionless"/>
        <!-- TODO the below parameters should be set in an init_states parameter file
 q_lv gets identified, the others are set arbitrarily, identifying q_lv sets the stressed volume of the system.-->
        <variable initial_value="0.00069934" name="q_lv" units="m3"/>
        <variable initial_value="1e-05" name="q_rv" units="m3"/>
        <variable initial_value="4e-06" name="q_la" units="m3"/>
        <variable initial_value="4e-06" name="q_ra" units="m3"/>
        <!-- calculate modified time due to changes in heart period. This can now be modified throughout a simulation.-->
        <variable initial_value="0.0" name="chi_a" units="dimensionless"/>
        <variable name="chi_afloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_afloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_a</ci>
                    <apply>
                        <floor/>
                        <ci>chi_a</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_a</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_astart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_astart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_afloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ar</ci>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <variable initial_value="0.0" name="chi_v" units="dimensionless"/>
        <variable name="chi_vfloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_vfloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_v</ci>
                    <apply>
                        <floor/>
                        <ci>chi_v</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_v</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_vstart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_vstart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vr</ci>
                        </apply>
                        <apply>
                            <gt/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>s</ci>
                </apply>
                <apply>
                    <divide/>
                    <cn cellml:units="second">1</cn>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>mt</ci>
                <apply>
                    <minus/>
                    <ci>s</ci>
                    <apply>
                        <floor/>
                        <ci>s</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Elastance Functions-->
            <apply>
                <eq/>
                <ci>t_astart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_astart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ac_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_ac</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ar_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>t_vstart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_vstart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vc_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vr_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vr</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_afloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_v</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_vfloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- Valve model-->
        <variable name="Rmod_valve_trv" public_interface="in" units="dimensionless"/>
        <variable name="Rmod_valve_puv" public_interface="in" units="dimensionless"/>
        <variable name="Rmod_valve_aov" public_interface="in" units="dimensionless"/>
        <variable name="Rmod_valve_miv" public_interface="in" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>B_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>Rmod_valve_trv</ci>
                        <ci>rho</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>Rmod_valve_puv</ci>
                        <ci>rho</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>Rmod_valve_miv</ci>
                        <ci>rho</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>Rmod_valve_aov</ci>
                        <ci>rho</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_aov</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_aov</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_trv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_trv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_trv</ci>
                        <ci>A_nn_trv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_puv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_puv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_puv</ci>
                        <ci>A_nn_puv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_miv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_miv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_miv</ci>
                        <ci>A_nn_miv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_aov</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                        </apply>
                        <ci>zeta_aov</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_aov</ci>
                        <ci>A_nn_aov</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_trv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_trv_pre</ci>
                            </apply>
                            <ci>K_vo_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_ra</ci>
                            <ci>u_rv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_trv_pre</ci>
                            <ci>K_vc_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_puv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_puv_pre</ci>
                            </apply>
                            <ci>K_vo_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_rv</ci>
                            <ci>u_par</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_puv_pre</ci>
                            <ci>K_vc_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_miv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_miv_pre</ci>
                            </apply>
                            <ci>K_vo_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_la</ci>
                            <ci>u_lv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_miv_pre</ci>
                            <ci>K_vc_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_aov_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_aov_pre</ci>
                            </apply>
                            <ci>K_vo_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_lv</ci>
                            <ci>u_root</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_aov_pre</ci>
                            <ci>K_vc_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <!-- The below ensures zeta can't be negative-->
            <apply>
                <eq/>
                <ci>zeta_trv</ci>
                <apply>
                    <max/>
                    <ci>zeta_trv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_puv</ci>
                <apply>
                    <max/>
                    <ci>zeta_puv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_miv</ci>
                <apply>
                    <max/>
                    <ci>zeta_miv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_aov</ci>
                <apply>
                    <max/>
                    <ci>zeta_aov_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <!-- calculate the flow through the valves-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_trv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_trv</ci>
                                </apply>
                                <ci>v_trv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_trv</ci>
                                </apply>
                            </apply>
                            <ci>u_ra</ci>
                        </apply>
                        <ci>u_rv</ci>
                    </apply>
                    <ci>L_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_puv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_puv</ci>
                                </apply>
                                <ci>v_puv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_puv</ci>
                                </apply>
                            </apply>
                            <ci>u_rv</ci>
                        </apply>
                        <ci>u_par</ci>
                    </apply>
                    <ci>L_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_miv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_miv</ci>
                                </apply>
                                <ci>v_miv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_miv</ci>
                                </apply>
                            </apply>
                            <ci>u_la</ci>
                        </apply>
                        <ci>u_lv</ci>
                    </apply>
                    <ci>L_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_aov</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_aov</ci>
                                </apply>
                                <ci>v_aov</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_aov</ci>
                                </apply>
                            </apply>
                            <ci>u_lv</ci>
                        </apply>
                        <ci>u_root</ci>
                    </apply>
                    <ci>L_aov</ci>
                </apply>
            </apply>
        </math>
        <!-- calculate velocities from flow and nominal (constant) area-->
        <variable name="vel_trv" units="m_per_s"/>
        <variable name="vel_puv" units="m_per_s"/>
        <variable name="vel_miv" units="m_per_s"/>
        <variable name="vel_aov" units="m_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>vel_trv</ci>
                <apply>
                    <divide/>
                    <ci>v_trv</ci>
                    <ci>A_nn_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>vel_puv</ci>
                <apply>
                    <divide/>
                    <ci>v_puv</ci>
                    <ci>A_nn_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>vel_miv</ci>
                <apply>
                    <divide/>
                    <ci>v_miv</ci>
                    <ci>A_nn_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>vel_aov</ci>
                <apply>
                    <divide/>
                    <ci>v_aov</ci>
                    <ci>A_nn_aov</ci>
                </apply>
            </apply>
            <!-- Constitutive Relations-->
            <apply>
                <eq/>
                <ci>u_ra</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_ra_A</ci>
                        </apply>
                        <ci>E_ra_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_ra</ci>
                        <ci>q_ra_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_rv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_rv_A</ci>
                        </apply>
                        <ci>E_rv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_rv</ci>
                        <ci>q_rv_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_la</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_la_A</ci>
                        </apply>
                        <ci>E_la_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_la</ci>
                        <ci>q_la_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_lv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_lv_A</ci>
                        </apply>
                        <ci>E_lv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_lv</ci>
                        <ci>q_lv_0</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_ra</ci>
                </apply>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>v_svc</ci>
                        <ci>v_ivc</ci>
                    </apply>
                    <ci>v_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_rv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_trv</ci>
                    <ci>v_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_la</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_pvn</ci>
                    <ci>v_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_lv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_miv</ci>
                    <ci>v_aov</ci>
                </apply>
            </apply>
        </math>
    </component>
    <component name="heart_simple_LVprop">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="0.0" name="s" public_interface="out" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="mt" units="second"/>
        <variable name="e_a" units="dimensionless"/>
        <variable name="e_v" units="dimensionless"/>
        <variable name="T" public_interface="in" units="second"/>
        <variable name="T_ac" public_interface="in" units="second"/>
        <variable name="T_ar" public_interface="in" units="second"/>
        <variable name="T_ac_norm" units="dimensionless"/>
        <variable name="T_ar_norm" units="dimensionless"/>
        <variable name="t_astart" public_interface="in" units="second"/>
        <variable name="t_astart_norm" units="dimensionless"/>
        <variable name="T_vc" public_interface="in" units="second"/>
        <variable name="T_vr" public_interface="in" units="second"/>
        <variable name="T_vc_norm" units="dimensionless"/>
        <variable name="T_vr_norm" units="dimensionless"/>
        <variable name="t_vstart" public_interface="in" units="second"/>
        <variable name="t_vstart_norm" units="dimensionless"/>
        <variable name="E_lv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_lv_B" public_interface="in" units="J_per_m6"/>
        <!--removed in for all E -->
        <variable name="E_la_A" units="J_per_m6"/>
        <variable name="E_la_B" units="J_per_m6"/>
        <variable name="E_rv_A" units="J_per_m6"/>
        <variable name="E_rv_B" units="J_per_m6"/>
        <variable name="E_ra_A" units="J_per_m6"/>
        <variable name="E_ra_B" units="J_per_m6"/>
        <variable name="q_ra_0" public_interface="in" units="m3"/>
        <variable name="q_rv_0" public_interface="in" units="m3"/>
        <variable name="q_la_0" public_interface="in" units="m3"/>
        <variable name="q_lv_0" public_interface="in" units="m3"/>
        <!-- State Variables-->
        <variable name="u_ra" public_interface="out" units="J_per_m3"/>
        <variable name="u_rv" units="J_per_m3"/>
        <variable name="u_la" public_interface="out" units="J_per_m3"/>
        <variable name="u_lv" units="J_per_m3"/>
        <variable name="u_root" public_interface="in" units="J_per_m3"/>
        <variable name="u_par" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0" name="v_trv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_puv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_miv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_aov" public_interface="out" units="m3_per_s"/>
        <variable name="v_svc" public_interface="in" units="m3_per_s"/>
        <variable name="v_ivc" public_interface="in" units="m3_per_s"/>
        <variable name="v_pvn" public_interface="in" units="m3_per_s"/>
        <variable name="L_trv" units="dimensionless"/>
        <variable name="L_puv" units="dimensionless"/>
        <variable name="L_miv" units="dimensionless"/>
        <variable name="L_aov" units="dimensionless"/>
        <variable name="A_eff_trv" units="m2"/>
        <variable name="A_eff_puv" units="m2"/>
        <variable name="A_eff_miv" units="m2"/>
        <variable name="A_eff_aov" units="m2"/>
        <variable name="A_nn_trv" public_interface="in" units="m2"/>
        <variable name="A_nn_puv" public_interface="in" units="m2"/>
        <variable name="A_nn_miv" public_interface="in" units="m2"/>
        <variable name="A_nn_aov" public_interface="in" units="m2"/>
        <variable name="l_eff" public_interface="in" units="metre"/>
        <variable name="K_vo_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="M_rg_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_aov" public_interface="in" units="dimensionless"/>
        <variable name="M_st_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_aov" public_interface="in" units="dimensionless"/>
        <variable name="rho" public_interface="in" units="Js2_per_m5"/>
        <variable name="B_trv" units="dimensionless"/>
        <variable name="B_puv" units="dimensionless"/>
        <variable name="B_miv" units="dimensionless"/>
        <variable name="B_aov" units="dimensionless"/>
        <variable name="zeta_trv" units="dimensionless"/>
        <variable name="zeta_puv" units="dimensionless"/>
        <variable name="zeta_miv" units="dimensionless"/>
        <variable name="zeta_aov" units="dimensionless"/>
        <variable initial_value="0" name="zeta_trv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_puv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_miv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_aov_pre" units="dimensionless"/>
        <variable initial_value="1e-14" name="eps" units="dimensionless"/>
        <variable initial_value="0.07" name="eps_1" units="dimensionless"/>
        <variable initial_value="0.02" name="eps_2" units="dimensionless"/>
        <!-- TODO the below parameters should be set in an init_states parameter file
 q_lv gets identified, the others are set arbitrarily, identifying q_lv sets the stressed volume of the system.-->
        <variable initial_value="1.5e-04" name="q_lv" units="m3"/>
        <variable initial_value="1e-05" name="q_rv" units="m3"/>
        <variable initial_value="4e-06" name="q_la" units="m3"/>
        <variable initial_value="4e-06" name="q_ra" units="m3"/>
        <!-- calculate modified time due to changes in heart period. This can now be modified throughout a simulation.-->
        <variable initial_value="0.0" name="chi_a" units="dimensionless"/>
        <variable name="chi_afloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_afloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_a</ci>
                    <apply>
                        <floor/>
                        <ci>chi_a</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_a</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_astart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_astart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_afloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ar</ci>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <variable initial_value="0.0" name="chi_v" units="dimensionless"/>
        <variable name="chi_vfloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_vfloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_v</ci>
                    <apply>
                        <floor/>
                        <ci>chi_v</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_v</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_vstart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_vstart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vr</ci>
                        </apply>
                        <apply>
                            <gt/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>s</ci>
                </apply>
                <apply>
                    <divide/>
                    <cn cellml:units="second">1</cn>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>mt</ci>
                <apply>
                    <minus/>
                    <ci>s</ci>
                    <apply>
                        <floor/>
                        <ci>s</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Elastance Functions-->
            <apply>
                <eq/>
                <ci>t_astart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_astart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ac_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_ac</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ar_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>t_vstart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_vstart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vc_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vr_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vr</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_afloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_v</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_vfloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- Valve model-->
            <apply>
                <eq/>
                <ci>B_trv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_trv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_puv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_miv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_aov</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_aov</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_aov</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_trv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_trv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_trv</ci>
                        <ci>A_nn_trv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_puv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_puv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_puv</ci>
                        <ci>A_nn_puv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_miv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_miv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_miv</ci>
                        <ci>A_nn_miv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_aov</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                        </apply>
                        <ci>zeta_aov</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_aov</ci>
                        <ci>A_nn_aov</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_trv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_trv_pre</ci>
                            </apply>
                            <ci>K_vo_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_ra</ci>
                            <ci>u_rv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_trv_pre</ci>
                            <ci>K_vc_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_puv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_puv_pre</ci>
                            </apply>
                            <ci>K_vo_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_rv</ci>
                            <ci>u_par</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_puv_pre</ci>
                            <ci>K_vc_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_miv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_miv_pre</ci>
                            </apply>
                            <ci>K_vo_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_la</ci>
                            <ci>u_lv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_miv_pre</ci>
                            <ci>K_vc_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_aov_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_aov_pre</ci>
                            </apply>
                            <ci>K_vo_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_lv</ci>
                            <ci>u_root</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_aov_pre</ci>
                            <ci>K_vc_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <!-- The below ensures zeta can't be negative-->
            <apply>
                <eq/>
                <ci>zeta_trv</ci>
                <apply>
                    <max/>
                    <ci>zeta_trv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_puv</ci>
                <apply>
                    <max/>
                    <ci>zeta_puv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_miv</ci>
                <apply>
                    <max/>
                    <ci>zeta_miv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_aov</ci>
                <apply>
                    <max/>
                    <ci>zeta_aov_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <!-- calculate the flow through the valves-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_trv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_trv</ci>
                                </apply>
                                <ci>v_trv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_trv</ci>
                                </apply>
                            </apply>
                            <ci>u_ra</ci>
                        </apply>
                        <ci>u_rv</ci>
                    </apply>
                    <ci>L_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_puv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_puv</ci>
                                </apply>
                                <ci>v_puv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_puv</ci>
                                </apply>
                            </apply>
                            <ci>u_rv</ci>
                        </apply>
                        <ci>u_par</ci>
                    </apply>
                    <ci>L_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_miv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_miv</ci>
                                </apply>
                                <ci>v_miv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_miv</ci>
                                </apply>
                            </apply>
                            <ci>u_la</ci>
                        </apply>
                        <ci>u_lv</ci>
                    </apply>
                    <ci>L_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_aov</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_aov</ci>
                                </apply>
                                <ci>v_aov</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_aov</ci>
                                </apply>
                            </apply>
                            <ci>u_lv</ci>
                        </apply>
                        <ci>u_root</ci>
                    </apply>
                    <ci>L_aov</ci>
                </apply>
            </apply>
        </math>
        <!-- calculate velocities from flow and nominal (constant) area-->
        <variable name="vel_trv" units="m_per_s"/>
        <variable name="vel_puv" units="m_per_s"/>
        <variable name="vel_miv" units="m_per_s"/>
        <variable name="vel_aov" units="m_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>vel_trv</ci>
                <apply>
                    <divide/>
                    <ci>v_trv</ci>
                    <ci>A_nn_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>vel_puv</ci>
                <apply>
                    <divide/>
                    <ci>v_puv</ci>
                    <ci>A_nn_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>vel_miv</ci>
                <apply>
                    <divide/>
                    <ci>v_miv</ci>
                    <ci>A_nn_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>vel_aov</ci>
                <apply>
                    <divide/>
                    <ci>v_aov</ci>
                    <ci>A_nn_aov</ci>
                </apply>
            </apply>
            <!-- Constitutive Relations-->
            <apply>
                <eq/>
                <ci>u_ra</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_ra_A</ci>
                        </apply>
                        <ci>E_ra_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_ra</ci>
                        <ci>q_ra_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_rv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_rv_A</ci>
                        </apply>
                        <ci>E_rv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_rv</ci>
                        <ci>q_rv_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_la</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_la_A</ci>
                        </apply>
                        <ci>E_la_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_la</ci>
                        <ci>q_la_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_lv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_lv_A</ci>
                        </apply>
                        <ci>E_lv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_lv</ci>
                        <ci>q_lv_0</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Identify LV elastances and scale all others in relation-->
            <apply>
                <eq/>
                <ci>E_rv_A</ci>
                <apply>
                    <times/>
                    <ci>E_lv_A</ci>
                    <cn cellml:units="dimensionless">0.8</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>E_ra_A</ci>
                <apply>
                    <times/>
                    <ci>E_lv_A</ci>
                    <cn cellml:units="dimensionless">0.02</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>E_la_A</ci>
                <apply>
                    <times/>
                    <ci>E_lv_A</ci>
                    <cn cellml:units="dimensionless">0.02</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>E_la_B</ci>
                <apply>
                    <times/>
                    <ci>E_lv_B</ci>
                    <cn cellml:units="dimensionless">0.9</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>E_ra_B</ci>
                <apply>
                    <times/>
                    <ci>E_lv_B</ci>
                    <cn cellml:units="dimensionless">0.9</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>E_rv_B</ci>
                <apply>
                    <times/>
                    <ci>E_lv_B</ci>
                    <cn cellml:units="dimensionless">0.6</cn>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_ra</ci>
                </apply>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>v_svc</ci>
                        <ci>v_ivc</ci>
                    </apply>
                    <ci>v_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_rv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_trv</ci>
                    <ci>v_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_la</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_pvn</ci>
                    <ci>v_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_lv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_miv</ci>
                    <ci>v_aov</ci>
                </apply>
            </apply>
        </math>
    </component>
    <component name="heart_devel">
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="0.0" name="s" public_interface="out" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="mt" units="second"/>
        <variable name="e_a" units="dimensionless"/>
        <variable name="e_v" units="dimensionless"/>
        <variable name="T" public_interface="in" units="second"/>
        <variable name="T_ac" public_interface="in" units="second"/>
        <variable name="T_ar" public_interface="in" units="second"/>
        <variable name="T_ac_norm" units="dimensionless"/>
        <variable name="T_ar_norm" units="dimensionless"/>
        <variable name="t_astart" public_interface="in" units="second"/>
        <variable name="t_astart_norm" units="dimensionless"/>
        <variable name="T_vc" public_interface="in" units="second"/>
        <variable name="T_vr" public_interface="in" units="second"/>
        <variable name="T_vc_norm" units="dimensionless"/>
        <variable name="T_vr_norm" units="dimensionless"/>
        <variable name="t_vstart" public_interface="in" units="second"/>
        <variable name="t_vstart_norm" units="dimensionless"/>
        <variable name="E_lv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_lv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_B" public_interface="in" units="J_per_m6"/>
        <variable name="q_ra_0" public_interface="in" units="m3"/>
        <variable name="q_rv_0" public_interface="in" units="m3"/>
        <variable name="q_la_0" public_interface="in" units="m3"/>
        <variable name="q_lv_0" public_interface="in" units="m3"/>
        <!-- State Variables-->
        <variable name="u_ra" public_interface="out" units="J_per_m3"/>
        <variable name="u_rv" units="J_per_m3"/>
        <variable name="u_la" public_interface="out" units="J_per_m3"/>
        <variable name="u_lv" units="J_per_m3"/>
        <variable name="u_root" public_interface="in" units="J_per_m3"/>
        <variable name="u_par" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0" name="v_trv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_puv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_miv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_aov" public_interface="out" units="m3_per_s"/>
        <variable name="v_svc" public_interface="in" units="m3_per_s"/>
        <variable name="v_ivc" public_interface="in" units="m3_per_s"/>
        <variable name="v_pvn" public_interface="in" units="m3_per_s"/>
        <variable name="L_trv" units="dimensionless"/>
        <variable name="L_puv" units="dimensionless"/>
        <variable name="L_miv" units="dimensionless"/>
        <variable name="L_aov" units="dimensionless"/>
        <variable name="A_eff_trv" units="m2"/>
        <variable name="A_eff_puv" units="m2"/>
        <variable name="A_eff_miv" units="m2"/>
        <variable name="A_eff_aov" units="m2"/>
        <variable name="A_nn_trv" public_interface="in" units="m2"/>
        <variable name="A_nn_puv" public_interface="in" units="m2"/>
        <variable name="A_nn_miv" public_interface="in" units="m2"/>
        <variable name="A_nn_aov" public_interface="in" units="m2"/>
        <variable name="l_eff" public_interface="in" units="metre"/>
        <variable name="K_vo_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="M_rg_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_aov" public_interface="in" units="dimensionless"/>
        <variable name="M_st_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_aov" public_interface="in" units="dimensionless"/>
        <variable name="rho" public_interface="in" units="Js2_per_m5"/>
        <variable name="B_trv" units="dimensionless"/>
        <variable name="B_puv" units="dimensionless"/>
        <variable name="B_miv" units="dimensionless"/>
        <variable name="B_aov" units="dimensionless"/>
        <variable name="zeta_trv" units="dimensionless"/>
        <variable name="zeta_puv" units="dimensionless"/>
        <variable name="zeta_miv" units="dimensionless"/>
        <variable name="zeta_aov" units="dimensionless"/>
        <variable initial_value="0" name="zeta_trv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_puv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_miv_pre" units="dimensionless"/>
        <variable initial_value="0" name="zeta_aov_pre" units="dimensionless"/>
        <variable initial_value="1e-22" name="eps" units="dimensionless"/>
        <variable initial_value="0.07" name="eps_1" units="dimensionless"/>
        <variable initial_value="0.02" name="eps_2" units="dimensionless"/>
        <!-- TODO the below parameters should be set in an init_states parameter file
 q_lv gets identified, the others are set arbitrarily, identifying q_lv sets the stressed volume of the system.-->
        <variable initial_value="0.00069934" name="q_lv" units="m3"/>
        <variable initial_value="1e-05" name="q_rv" units="m3"/>
        <variable initial_value="4e-06" name="q_la" units="m3"/>
        <variable initial_value="4e-06" name="q_ra" units="m3"/>
        <!-- calculate modified time due to changes in heart period. This can now be modified throughout a simulation.-->
        <variable initial_value="0.0" name="chi_a" units="dimensionless"/>
        <variable name="chi_afloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_afloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_a</ci>
                    <apply>
                        <floor/>
                        <ci>chi_a</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_a</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_astart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_astart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_afloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_ar</ci>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <variable initial_value="0.0" name="chi_v" units="dimensionless"/>
        <variable name="chi_vfloor" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_vfloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_v</ci>
                    <apply>
                        <floor/>
                        <ci>chi_v</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_v</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_vstart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_vstart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="second">0.5</cn>
                            <ci>T_vr</ci>
                        </apply>
                        <apply>
                            <gt/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>s</ci>
                </apply>
                <apply>
                    <divide/>
                    <cn cellml:units="second">1</cn>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>mt</ci>
                <apply>
                    <minus/>
                    <ci>s</ci>
                    <apply>
                        <floor/>
                        <ci>s</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Elastance Functions-->
            <apply>
                <eq/>
                <ci>t_astart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_astart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ac_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_ac</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_ar_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>t_vstart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_vstart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vc_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vc</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>T_vr_norm</ci>
                <apply>
                    <divide/>
                    <ci>T_vr</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_afloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_v</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_vfloor</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- Valve model-->
        <variable name="B_trv_pre" units="dimensionless"/>
        <variable name="B_puv_pre" units="dimensionless"/>
        <variable name="B_miv_pre" units="dimensionless"/>
        <variable name="B_aov_pre" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>B_trv_pre</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_trv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv_pre</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_puv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv_pre</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_miv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
        </math>
        <!-- B_aov = rho/(2{dimensionless}*sqr(A_eff_aov)+eps);-->
        <variable name="gamma" public_interface="in" units="dimensionless"/>
        <variable name="beta" public_interface="in" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>B_aov_pre</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>gamma</ci>
                        <ci>rho</ci>
                        <apply>
                            <power/>
                            <apply>
                                <times/>
                                <pi/>
                                <apply>
                                    <power/>
                                    <ci>r_ao</ci>
                                    <cn cellml:units="dimensionless">2</cn>
                                </apply>
                            </apply>
                            <ci>beta</ci>
                        </apply>
                    </apply>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <apply>
                                <power/>
                                <ci>r_lvot</ci>
                                <cn cellml:units="dimensionless">4</cn>
                            </apply>
                            <apply>
                                <power/>
                                <ci>A_eff_aov</ci>
                                <ci>beta</ci>
                            </apply>
                        </apply>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_trv</ci>
                <piecewise>
                    <piece>
                        <ci>B_trv_pre</ci>
                        <apply>
                            <lt/>
                            <ci>B_trv_pre</ci>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                <apply>
                                    <minus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <exp/>
                                        <apply>
                                            <divide/>
                                            <apply>
                                                <minus/>
                                                <ci>B_trv_pre</ci>
                                            </apply>
                                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                        </apply>
                                    </apply>
                                </apply>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv</ci>
                <piecewise>
                    <piece>
                        <ci>B_puv_pre</ci>
                        <apply>
                            <lt/>
                            <ci>B_puv_pre</ci>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                <apply>
                                    <minus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <exp/>
                                        <apply>
                                            <divide/>
                                            <apply>
                                                <minus/>
                                                <ci>B_puv_pre</ci>
                                            </apply>
                                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                        </apply>
                                    </apply>
                                </apply>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv</ci>
                <piecewise>
                    <piece>
                        <ci>B_miv_pre</ci>
                        <apply>
                            <lt/>
                            <ci>B_miv_pre</ci>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                <apply>
                                    <minus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <exp/>
                                        <apply>
                                            <divide/>
                                            <apply>
                                                <minus/>
                                                <ci>B_miv_pre</ci>
                                            </apply>
                                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                        </apply>
                                    </apply>
                                </apply>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <ci>B_aov</ci>
                <piecewise>
                    <piece>
                        <ci>B_aov_pre</ci>
                        <apply>
                            <lt/>
                            <ci>B_aov_pre</ci>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <plus/>
                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>10</cn>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                <apply>
                                    <minus/>
                                    <cn cellml:units="dimensionless">1</cn>
                                    <apply>
                                        <exp/>
                                        <apply>
                                            <divide/>
                                            <apply>
                                                <minus/>
                                                <ci>B_aov_pre</ci>
                                            </apply>
                                            <cn cellml:units="dimensionless" type="e-notation">1<sep/>16</cn>
                                        </apply>
                                    </apply>
                                </apply>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <ci>L_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps</ci>
                    </apply>
                </apply>
            </apply>
            <!-- L_aov = rho*l_eff/(A_eff_aov + eps);-->
            <apply>
                <eq/>
                <ci>L_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <times/>
                        <pi/>
                        <apply>
                            <power/>
                            <ci>r_lvot</ci>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_trv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_trv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_trv</ci>
                        <ci>A_nn_trv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_puv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_puv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_puv</ci>
                        <ci>A_nn_puv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_miv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_miv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_miv</ci>
                        <ci>A_nn_miv</ci>
                    </apply>
                </apply>
            </apply>
            <!-- A_eff_aov = (M_st_aov*A_nn_aov-M_rg_aov*A_nn_aov)*zeta_aov+M_rg_aov*A_nn_aov;-->
            <apply>
                <eq/>
                <ci>A_eff_aov</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_aov</ci>
                                <ci>A_aov</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_aov</ci>
                                <ci>A_aov</ci>
                            </apply>
                        </apply>
                        <ci>zeta_aov</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_aov</ci>
                        <ci>A_aov</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_trv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_trv_pre</ci>
                            </apply>
                            <ci>K_vo_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_ra</ci>
                            <ci>u_rv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_trv_pre</ci>
                            <ci>K_vc_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_puv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_puv_pre</ci>
                            </apply>
                            <ci>K_vo_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_rv</ci>
                            <ci>u_par</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_puv_pre</ci>
                            <ci>K_vc_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_miv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_miv_pre</ci>
                            </apply>
                            <ci>K_vo_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_la</ci>
                            <ci>u_lv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_miv_pre</ci>
                            <ci>K_vc_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_aov_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_aov_pre</ci>
                            </apply>
                            <ci>K_vo_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_lv</ci>
                            <ci>u_root</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_aov_pre</ci>
                            <ci>K_vc_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <!-- The below ensures zeta can't be negative-->
            <apply>
                <eq/>
                <ci>zeta_trv</ci>
                <apply>
                    <max/>
                    <ci>zeta_trv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_puv</ci>
                <apply>
                    <max/>
                    <ci>zeta_puv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_miv</ci>
                <apply>
                    <max/>
                    <ci>zeta_miv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_aov</ci>
                <apply>
                    <max/>
                    <ci>zeta_aov_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <!-- calculate the flow through the valves-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_trv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_trv</ci>
                                </apply>
                                <ci>v_trv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_trv</ci>
                                </apply>
                            </apply>
                            <ci>u_ra</ci>
                        </apply>
                        <ci>u_rv</ci>
                    </apply>
                    <ci>L_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_puv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_puv</ci>
                                </apply>
                                <ci>v_puv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_puv</ci>
                                </apply>
                            </apply>
                            <ci>u_rv</ci>
                        </apply>
                        <ci>u_par</ci>
                    </apply>
                    <ci>L_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_miv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_miv</ci>
                                </apply>
                                <ci>v_miv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_miv</ci>
                                </apply>
                            </apply>
                            <ci>u_la</ci>
                        </apply>
                        <ci>u_lv</ci>
                    </apply>
                    <ci>L_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_aov</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_aov</ci>
                                </apply>
                                <ci>v_aov</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_aov</ci>
                                </apply>
                            </apply>
                            <ci>u_lv</ci>
                        </apply>
                        <ci>u_root</ci>
                    </apply>
                    <ci>L_aov</ci>
                </apply>
            </apply>
        </math>
        <!-- calculate velocities from flow and nominal (constant) area-->
        <variable name="vel_aov" public_interface="out" units="m_per_s"/>
        <variable name="r_lvot" public_interface="in" units="metre"/>
        <variable name="r_ao" public_interface="in" units="metre"/>
        <variable name="A_aov" public_interface="in" units="m2"/>
        <!-- A_nn_aov = A_aov;-->
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>vel_aov</ci>
                <apply>
                    <divide/>
                    <ci>v_aov</ci>
                    <apply>
                        <times/>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">3</cn>
                            <cn cellml:units="dimensionless">4</cn>
                        </apply>
                        <pi/>
                        <apply>
                            <power/>
                            <ci>r_lvot</ci>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- Constitutive Relations-->
            <apply>
                <eq/>
                <ci>u_ra</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_ra_A</ci>
                        </apply>
                        <ci>E_ra_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_ra</ci>
                        <ci>q_ra_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_rv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_rv_A</ci>
                        </apply>
                        <ci>E_rv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_rv</ci>
                        <ci>q_rv_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_la</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_la_A</ci>
                        </apply>
                        <ci>E_la_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_la</ci>
                        <ci>q_la_0</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_lv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_lv_A</ci>
                        </apply>
                        <ci>E_lv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_lv</ci>
                        <ci>q_lv_0</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_ra</ci>
                </apply>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>v_svc</ci>
                        <ci>v_ivc</ci>
                    </apply>
                    <ci>v_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_rv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_trv</ci>
                    <ci>v_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_la</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_pvn</ci>
                    <ci>v_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_lv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_miv</ci>
                    <ci>v_aov</ci>
                </apply>
            </apply>
        </math>
    </component>
</model>
